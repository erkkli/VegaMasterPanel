SET language english
DECLARE @TRH1 AS DATETIME='{TARIH1}'
DECLARE @TRH2 AS DATETIME='{TARIH2}'
DECLARE @KOD1 NVARCHAR(100)='{KOD1}'
DECLARE @KOD2 AS NVARCHAR(100)='{KOD2}'
DECLARE @URUNADI AS NVARCHAR(100)='{URUNADI}'
DECLARE @TEKTRH AS NVARCHAR(100)='{TEKTRH}'
DECLARE @GUN AS NVARCHAR(100)='{GUN}'
DECLARE @SAAT AS NVARCHAR(100)='{SAAT}'


SELECT 
case WHEN DATEPART(HOUR, [date])=0 THEN 24 else  DATEPART(HOUR, [date]) end  as Saat,
SUM(Quantity*AGIRLIK) as Miktar,
(SELECT SUM(Quantity*AGIRLIK) FROM [dbo].[Bill] WHERE Date>=@TRH1  AND Date<=@TRH2 AND KOD1 LIKE '%DONER%' #KOD1WHERE# #KOD2WHERE# #URUNADIWHERE# #TEKTRHWHERE# #GUNWHERE# #SAATWHERE#) AS ToplamSatýs,
SUM(Quantity*AGIRLIK)/(SELECT SUM(Quantity*AGIRLIK) FROM [dbo].[Bill] WHERE Date>=@TRH1  AND Date<=@TRH2 #KOD1WHERE# #KOD2WHERE# #URUNADIWHERE# #TEKTRHWHERE# #GUNWHERE# #SAATWHERE#)*100 as Oran
 FROM [dbo].[Bill]
WHERE  KOD1 LIKE '%DONER%' AND  Date>=@TRH1  AND Date<=@TRH2 #KOD1WHERE# #KOD2WHERE# #URUNADIWHERE# #TEKTRHWHERE# #GUNWHERE# #SAATWHERE#
group by
case WHEN DATEPART(HOUR, [date])=0 THEN 24 else  DATEPART(HOUR, [date]) end 
