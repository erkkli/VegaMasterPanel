@model IEnumerable<SefimV2.ViewModels.SubeSettings.SubeSettingsViewModel>

@{
    #region base URL bilgisi set ediliyor
    var urlHelper = new UrlHelper(Html.ViewContext.RequestContext);
    string baseUrl = urlHelper.Content("~");
    #endregion

    var uygulamaTipi = ViewBag.UygulamaTipi;

    #region View tanımları
    ViewBag.Title = "";
    string PagecontentClass = "";
    string CloseButton = "";
    string CloseButtonHeader = "";
    string CancelButton = "";

    string Controller = ViewBag.Controller;
    Dictionary<string, string> PageNavi = ViewBag.PageNavi;

    if (ViewBag.Page == "modal")
    {
        Layout = "~/Views/Shared/_Layout_Modal.cshtml";
        PagecontentClass = "modal-page-margintop";
        CloseButton = "<button type='button' data-dismiss='modal' class='btn btn-danger' id='CloseModal'> Vazgeç </button>";
        CloseButtonHeader = "<button type='button' class='close' data-dismiss='modal' aria-hidden='true'></button>";
    }
    else
    {
        if (uygulamaTipi == "sp")
        {
            Layout = "~/Views/Shared/_LayoutPageSPos.cshtml";
        }
        else
        {
            Layout = "~/Views/Shared/_LayoutPage.cshtml";
            PagecontentClass = "page-content";
            CancelButton = "<a href='" + Url.Action("Index", "OzetRaporlar/List") + "' class='btn btn-danger'> Vazgeç </a>";
        }
    }
    #endregion
}


<link href="/Assets/css/bootstrap.css" rel="stylesheet" />
<link href="/Assets/css/custom.css" rel="stylesheet" />
<link href="/Assets/plugins/fUpload/Uploader-style.css" rel="stylesheet" />
<link href="~/Content/ContentSefPanel/css/costomfieldset/customfielset.css" rel="stylesheet" />

<div id="content" class="form-horizontal">
    <div class="row">
        <div class="col-lg-12">
            <div id="notification"></div>
        </div>
    </div>
    <fieldset class="well the-fieldset margin-bottom-10 padding-bottom-10 padding-top-20">
        <legend class="the-legend">@ViewBag.PageTitle @ViewBag.ActionTitle </legend>
        <div class="col-lg-12 col-sm-12 col-xs-12">
            <div class="table table-responsive">

                @*<a href="javascript:void(0)" onclick="openModalInsert()" class="btn btn-primary"><i class="la la-plus"></i> Yeni Ekle</a>*@
                <button type="submit" onclick="location.href='@Url.Action("Ekle", "SubeSettings" , new { ut=uygulamaTipi})'" class="btn btn-success">
                    <span class="glyphicon glyphicon-plus txt-color-white margin-right-5"></span>
                    Yeni Kayıt
                </button>
                <div id="gridView">
                    <table id="tableRapor" class="table table-responsive table-bordered table-hover" style="width:100%">
                        <thead>
                            <tr style="background: #fffaf0">
                                <th style="width:10px">Durumu</th>
                                <th style="width:10px">Düzenle</th>
                                <th style="width:10px;">Sil</th>
                                <th>Uygulama Adı</th>
                                <th>DB Durumu</th>
                                <th>Şube Adı</th>
                                <th>Şube Ip</th>
                                <th>SQL Adı </th>
                                <th>SQL Şifre</th>
                                <th>Database Adı</th>
                                <th>Vega Firma</th>
                                <th>Vega Dönem</th>
                                <th>Vega Depo</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                foreach (var item in Model)
                                {
                                    var FasterAndSefim = "";
                                    var FasterOnlineOfline = "";
                                    var Durum = "";
                                    var color = "";
                                    if (item.AppDbType == 1)
                                    {
                                        FasterAndSefim = "Şefim Yeni";
                                    }
                                    else if (item.AppDbType == 2)
                                    {
                                        FasterAndSefim = "Şefim Eski";
                                    }
                                    else if (item.AppDbType == 3)
                                    {
                                        FasterAndSefim = "Faster";
                                    }
                                    else if (item.AppDbType == 4)
                                    {
                                        FasterAndSefim = "NPOS";
                                    }
                                    else if (item.AppDbType == 5)
                                    {
                                        FasterAndSefim = "V-POS";
                                    }

                                    if (item.AppDbTypeStatus == true)
                                    {
                                        FasterOnlineOfline = "Online";
                                    }
                                    else
                                    {
                                        FasterOnlineOfline = "Ofline";
                                    }

                                    if (item.Status == true)
                                    {
                                        Durum = "Aktif";
                                        color = "#52BE80; color: White";
                                    }
                                    else
                                    {
                                        Durum = "Pasif";
                                        color = "#f0ad4e; color: White";
                                    }

                                    <tr>
                                        <td>
                                            <button id="veriSubeId" , new { onclick="return confirm('Şube durumu değiştirilsin mi?');" } type="button" style="background-color:@color; text-align:center;" class="btn btn-default" data-id="@item.ID" title="Şube durumunu pasif yapar"> @Durum</button>
                                        </td>
                                        <td>
                                            <a class="btn btn-primary" href="@Url.Action("Ekle", "SubeSettings", new { ID = item.ID, ut=uygulamaTipi})" title="Şube düzenle">
                                                Düzenle
                                            </a>
                                        </td>
                                        <td>
                                            <a class="btn btn-danger" title="Şube sil" href="@Url.Action("Delete", "SubeSettings", new { ID= item.ID })" onclick="return confirm('Şubeyi silmek istiyormusunuz?');">
                                                Sil
                                            </a>
                                        </td>
                                        <td> @FasterAndSefim </td>
                                        <td> @FasterOnlineOfline </td>
                                        <td> @item.SubeName  </td>
                                        <td> @item.SubeIP </td>
                                        <td> @item.SqlName </td>
                                        <td> @item.SqlPassword </td>
                                        <td> @item.DBName </td>
                                        <td> @item.FirmaID </td>
                                        <td> @item.DonemID </td>
                                        <td> @item.DepoID </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </fieldset>
</div>

<script type="text/javascript">

    jQuery(document).ready(function () {

        $(document).on("click", "#veriSubeId", function (e) {
            var Limit = $(this).data('id');
            //console.log("id get", Limit);
            var Sube_ID = Limit;
            SubeAktifPasif(Sube_ID);
        });

        SubeAktifPasif = function (Sube_ID) {
            var DataUrl = '/SubeSettings/SubeAktifPasifYapma?Sube_ID=' + Sube_ID + '';
            $.ajax
                ({
                    url: DataUrl,
                    type: 'GET',
                    dataType: 'json',
                    beforeSend: function (request) { },
                    complete: function () {
                        //console.log("tets");
                        /* window.setTimeout(function () { App.unblockUI(); }, 1000); */
                    },
                    success: function (data) {

                        //console.log("datata", data);
                        window.location.reload(500);
                        //alert(' Başarılı');
                        //setInterval(function () { window.location.reload(); }, 100);
                    }
                });
        }
    });

</script>


<script>
    $(document).ready(function () {
        $('.tarihLink').each(function () {
            $(this).on('click', function (ev) {
                ev.preventDefault();
                if (localStorage.durum == null) {
                    localStorage.durum = "bugun";
                }
                document.getElementById("loading").setAttribute("class", "myloading-active");
                document.getElementById("contbody").setAttribute("style", "position:fixed;");
                location.href = $(this).attr('href') + '?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
            })
        });

        if (localStorage.durum == "bugun") {
            $(".btnToday").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnToday").addClass("LimitButtonBack");
        } else if (localStorage.durum == "dun") {
            $(".btnYesterday").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnYesterday").addClass("LimitButtonBack");
        } else if (localStorage.durum == "buAy") {
            $(".btnMonth").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnMonth").addClass("LimitButtonBack");
        } else if (localStorage.durum = "tarihAraligi") {
            $(".btnRange").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnRange").addClass("LimitButtonBack");
        }
    });

    $('.btnToday').click(function () {
        localStorage.durum = "bugun";
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });
    $('.btnYesterday').click(function () {
        localStorage.durum = "dun";
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });
    $('.btnMonth').click(function () {
        localStorage.durum = "buAy";
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });

    $('.btnSave').click(function () {
        var tarihBaslangic = $("#dateGecerlilikTarihi").val() + ' ' + $("#basSaat").val();
        var tarihBitis = $("#dateBitisTarihi").val() + ' ' + $("#bitisSaat").val();
        localStorage.durum = "tarihAraligi";
        localStorage.tarihBaslangic = tarihBaslangic;
        localStorage.tarihBitis = tarihBitis;
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
    });

</script>
