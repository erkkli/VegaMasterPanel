@{
    string StartDateTime = ViewBag.StartDateTime;
    var EndDateTime = ViewBag.EndDateTime;
    ViewBag.Title = "Icmal Raporları" + " \n\rTarih: " + StartDateTime + " / " + EndDateTime + " ";
    //Layout = "~/Views/Shared/_LayoutPage.cshtml";
}

@model IEnumerable<SefimV2.ViewModels.Icmal.IcmalViewModel>

@*<link href="~/Content/ContentSefPanel/css/fieldset/jquery.coolfieldset.css" rel="stylesheet" />
    <link href="~/Content/ContentSefPanel/css/eker/eker.css" rel="stylesheet" />*@


<style>
    .LimitButtonBack {
        background: #3bab10; /* #28bf3a;*/
        color: #ffffff !important;
    }
</style>

<div class="col-lg-12 col-sm-12 col-xs-12">
    @*<a class="btn btn-SM btn-success" style="margin-top:5px" href="@Url.Action("Create", "Icmal")" title="İcmal eklenecek sayfaya yönlendirir.">
            İcmal Ekle
        </a>*@

    <table id="tableIcmalListId" class="table table-responsive table-bordered table-condensed " style="width:100%;">
        <thead>
            <tr style="background-color:#e3e6eb">
                <th>İşlem</th>
                <th>Tarih</th>
                <th>Nakit</th>
                <th>K.Kartı</th>
                <th>Y.Çeki</th>
                <th>Online S.</th>
                <th>Açık Hesap</th>
            </tr>
        </thead>
        <tbody>
            @{
                try
                {
                    Html.HiddenFor(model => model.FirstOrDefault().SubeName);
                    Html.HiddenFor(model => model.FirstOrDefault().Id);

                    foreach (var item in Model)
                    {
                        var backgroundColor = string.Empty;
                        if (item.OnayDurumu == SefimV2.Enums.General.OnayDurumu.Onayli)
                        {
                            backgroundColor = "background-color:#ecf8ee";
                        }
                        else if (item.OnayDurumu == SefimV2.Enums.General.OnayDurumu.OnayBekliyor)
                        {
                            backgroundColor = "background-color:#fff7e0";
                        }

                        <tr id="row_@item.SubeId" style="color:#000000;font-weight:bold; @backgroundColor; ">
                            <td>
                                @*<a class='btn btn-xs btn-primary btnOrtakUrunEdit' data-url="@Url.Action("IcmalCompare", "Icmal",
                                                                                                        new {
                                                                                                            subeId = item.SubeId,
                                                                                                            paymentDate = item.PaymentDate,
                                                                                                        }) " title="Satışları karşılaştır">
                                        <span class="glyphicon glyphicon-edit"></span>
                                        Karşılaştır
                                    </a>*@

                                <a class='btn btn-xs btn-primary ' target="IcmalCompare" href="@Url.Action("IcmalCompare", "Icmal",
                                                                                                            new {
                                                                                                                id=item.Id,
                                                                                                                subeName=item.SubeName,
                                                                                                                subeId = item.SubeId,
                                                                                                                paymentDate = item.PaymentDate,
                                                                                                            }) " title="Satışları karşılaştır">
                                    <span class="glyphicon glyphicon-edit"></span>
                                    Karşılaştır
                                </a>
                            </td>
                            <td> @item.PaymentDate </td>
                            <td> @String.Format("{0:#,###.00;-#,###.00;0}", item.CashAmount) </td>
                            <td> @String.Format("{0:#,###.00;-#,###.00;0}", item.KreditAmount) </td>
                            <td> @String.Format("{0:#,###.00;-#,###.00;0}", item.TicketAmount) </td>
                            <td>@String.Format("{0:#,###.00;-#,###.00;0}", item.OnlineAmount) </td>
                            <td> @String.Format("{0:#,###.00;-#,###.00;0}", item.DebitAmount) </td>

                        </tr>
                    }
                }
                catch (Exception)
                { }
            }
        </tbody>
    </table>

</div>

<div class="modal fade" id="modalForm" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="ClearModal()" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Tarih Aralığı Seç</h4>
            </div>
            <div class="modal-body">
                <div class="clearfix"></div>
                <div class="form-group" style="margin-top:10px !important;">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Başlangıç Tarihi</label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="controls">
                            <div class="col-md-12 xdisplay_inputx form-group has-feedback">
                                <input type="text" class="form-control has-feedback-left" id="dateGecerlilikTarihi" placeholder="Seçiniz" aria-describedby="inputSuccess2Status4">
                                <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                                <span id="inputSuccess2Status4" class="sr-only">(success)</span>
                            </div>
                        </div>
                    </div>
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Başlangıç Saati</label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="controls">
                            <input type="time" id="basSaat" name="appt" min="9:00" max="18:00" required>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
                <div class="form-group" style="margin-top:10px !important;">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Bitiş Tarihi</label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="controls">
                            <div class="col-md-12 xdisplay_inputx form-group has-feedback">
                                <input type="text" class="form-control has-feedback-left" id="dateBitisTarihi" placeholder="Seçiniz" aria-describedby="inputSuccess2Status5">
                                <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                                <span id="inputSuccess2Status5" class="sr-only">(success)</span>
                            </div>
                        </div>
                    </div>
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">Bitiş Saati</label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="controls">
                            <input type="time" id="bitisSaat" name="appt" min="9:00" max="18:00" required>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button id="btnSave" type="button" class="btnSave btn btn-success" data-id="0">Gönder</button>
                <button type="button" class="btn btn-warning" onclick="ClearModal()" data-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEpostaForm" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">E-Posta Gönder</h4>
            </div>
            <div class="modal-body">
                <div class="clearfix"></div>
                <div class="form-group" style="margin-top:10px !important;">
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="controls">
                            <div class="form-group m-form__group row  has-feedback ">
                                <label class="col-form-label col-lg-3 col-sm-12">E-Posta </label>
                                <div class="col-lg-9 col-md-9 col-sm-12">
                                    <input type="email" id="ePostaAdress" class="form-control" aria-describedby="emailHelp" placeholder="E Posta Giriniz">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button id="btnEpostasave" type="button" class="btnEpostasave btn btn-success" data-id="0"><i class="fa fa-mail-forward"></i> Gönder</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Kapat</button>
            </div>
        </div>
    </div>
</div>

@*<script src="~/Scripts/Scripts/jquery.validate-vsdoc.js"></script>
    <script src="~/Scripts/Scripts/jquery.validate.js"></script>
    <script src="~/Scripts/Scripts/fieldset/jquery.coolfieldset.js"></script>
    <script src="~/Scripts/Scripts/custom/eker/eker.js"></script>*@
<script type="text/javascript">

    $(".btnOrtakUrunEdit").on("click", function () {
        $('#genericModal').find(".modal-body").html("");
        var dataurl = $(this).data("url");
        callModalPage(dataurl, "İcmal Karşılaştırma");
        showProgressBar();
        $("#modalPleaseWait").on('shown.bs.modal', function () {
        });
    });

    $(document).ready(function () {

        var buttonCommon = {
            exportOptions: {
                format: {
                    body: function (data, row, column, node) {
                        console.log(" data_", data);
                        return data.replace(/[$,.]/g, '.')
                        data;
                    }
                }
            }
        };

        $('#tableIcmalListId').DataTable({
            language: {
                info: "_TOTAL_ kayıttan _START_ - _END_ kayıt gösteriliyor.",
                infoEmpty: "Gösterilecek hiç kayıt yok.",
                loadingRecords: "Kayıtlar yükleniyor.",
                zeroRecords: "Tablo boş",
                search: "Arama:",
                infoFiltered: "(toplam _MAX_ kayıttan filtrelenenler)",
                buttons: {
                    copyTitle: "Panoya kopyalandı.",
                    copySuccess: "Panoya %d satır kopyalandı",
                    copy: "Kopyala",
                    print: "Yazdır",
                },
                paginate: {
                    first: "İlk",
                    previous: "Önceki",
                    next: "Sonraki",
                    last: "Son"
                },
            },
            dom: 'Bfrtip',
            "pageLength": 80,
            //buttons: [
            //    'copy', 'excel', 'pdf', 'print'
            //],

            buttons: [
                $.extend(true, {}, buttonCommon, {
                    extend: 'copyHtml5'
                }),
                $.extend(true, {}, buttonCommon, {
                    extend: 'excelHtml5'
                }),
                $.extend(true, {}, buttonCommon, {
                    extend: 'pdfHtml5'
                }),
                //$.extend(true, {}, buttonCommon, {
                //    extend: 'printHtml5'
                //})
                'print'
            ],
        });
    });
</script>

<script>
    $(document).ready(function () {
        $('.tarihLink').each(function () {
            $(this).on('click', function (ev) {
                ev.preventDefault();
                if (localStorage.durum == null) {
                    localStorage.durum = "bugun";
                }
                document.getElementById("loading").setAttribute("class", "myloading-active");
                document.getElementById("contbody").setAttribute("style", "position:fixed;");
                location.href = $(this).attr('href') + '?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
            })
        });


        if (localStorage.durum == "bugun") {
            $(".btnToday").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnToday").addClass("LimitButtonBack");
        } else if (localStorage.durum == "dun") {
            $(".btnYesterday").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnYesterday").addClass("LimitButtonBack");
        } else if (localStorage.durum == "buAy") {
            $(".btnMonth").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnMonth").addClass("LimitButtonBack");
        } else if (localStorage.durum = "tarihAraligi") {
            $(".btnRange").removeClass("LimitButtonBack");
            $(this).addClass("LimitButtonBack");
            $("#btnRange").addClass("LimitButtonBack");
        }
    });

    function ClearModal() {
        $("#dateGecerlilikTarihi").val("");
        $("#dateBitisTarihi").val("");
        $("#btnSave").attr("data-id", 0);
        $("#bitisSaat").val("");
        $("#basSaat").val("");
    }

    $('.btnToday').click(function () {
        localStorage.durum = "bugun";
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });
    $('.btnYesterday').click(function () {
        localStorage.durum = "dun";
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });
    $('.btnMonth').click(function () {
        localStorage.durum = "buAy";
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });

    $('.btnSave').click(function () {
        var tarihBaslangic = $("#dateGecerlilikTarihi").val() + ' ' + $("#basSaat").val();
        var tarihBitis = $("#dateBitisTarihi").val() + ' ' + $("#bitisSaat").val();
        localStorage.durum = "tarihAraligi";
        localStorage.tarihBaslangic = tarihBaslangic;
        localStorage.tarihBitis = tarihBitis;
        location.href = 'List?durum=' + localStorage.durum + '&tarihBas=' + localStorage.tarihBaslangic + '&tarihBitis=' + localStorage.tarihBitis;
        document.getElementById("loading").setAttribute("class", "myloading-active");
        document.getElementById("contbody").setAttribute("style", "position:fixed;");
    });

</script>


<script type="text/javascript">
    $(document).ready(function () {
        $('#RefreshPage').click(function () {
            document.getElementById("loading").setAttribute("class", "myloading-active");
            document.getElementById("contbody").setAttribute("style", "position:fixed;");
            window.location.reload();
        });
    });
</script>