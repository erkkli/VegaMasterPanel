
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPageReports.cshtml";
}


@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPageReports.cshtml";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<style>
    .dataTables_wrapper, #saateGoreSatislar, #gunlereGoreSatislar {
        -webkit-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.58);
        -moz-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.58);
        box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.58);
        padding: 10px
    }



    table tbody tr {
        cursor: pointer
    }

    table caption b {
        color: black
    }

    table caption button {
        float: right
    }
</style>
<div class="form-group">
    <div>
        <button id="btnToday" onclick="dateButtonClick(this)" class="btnToday btn btn-primary pull-left" type="button"><i class="glyphicon"></i>Bugün</button>
        <button id="btnYesterday" onclick="dateButtonClick(this)" class="btnYesterday btn btn-primary pull-left" type="button"><i class="glyphicon"></i>Dün</button>
        <button id="btnMonth" onclick="dateButtonClick(this)" class="btnMonth btn btn-primary pull-left" type="button"><i class="glyphicon"></i>Bu Ay</button>
    </div>
    <div style="float:left">
        <div class="controls" style="float:left">
            <div class="col-md-12 xdisplay_inputx form-group has-feedback">
                <input type="text" class="form-control has-feedback-left" id="dateGecerlilikTarihi" placeholder="Seçiniz" aria-describedby="inputSuccess2Status4">
                <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                <span id="inputSuccess2Status4" class="sr-only">(success)</span>
            </div>
        </div>
        <div class="controls" style="float:left">
            <div class="col-md-12 xdisplay_inputx form-group has-feedback">
                <input type="text" class="form-control has-feedback-left" id="dateBitisTarihi" placeholder="Seçiniz" aria-describedby="inputSuccess2Status5">
                <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                <span id="inputSuccess2Status5" class="sr-only">(success)</span>
            </div>
        </div>
        <a class="btn btn-primary btn-sm text-white" onclick="searchFunc()"><i class="fa fa-search"></i></a>

    </div>
    <div style="clear:both"></div>
</div>

<div class="row" id="tableDiv">

</div>



<script type="text/javascript">

    var SUBEADI = "";
    var KANAL = "";
    var URUNADI = "";
    var ODEMETIPI = "";
    var SATISTIPI = "";
    var OPSIYONTIPI = "";


    function formatCurrency(currency) {
        var currency_symbol = "₺"
        var formattedOutput = new Intl.NumberFormat('tr-TR', {
            style: 'currency',
            currency: 'TRY',
            minimumFractionDigits: 2,
        });

        return formattedOutput.format(currency).replace(currency_symbol, '')
    }
    $(document).ready(function () {
        $("#loading").attr("style", "position: fixed;top:0");
        $("#loading").attr("class", "myloading-active");
        setTimeout(function () {
            $("#loading").attr("class", "myloading");
        }, 1500);


    });
    Date.prototype.addHours = function (hour) {
        var date = new Date(this.valueOf());
        date.setHours(date.getDate() + hour);
        return date;
    }
    function dateButtonClick(btn) {
        var theData = {
            btnID: btn.id
        }
        $.ajax({
            url: '/SatislarAnaliz/dateButtonClick',
            type: 'GET',
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                $("#dateGecerlilikTarihi").val(result.startDate)
                $("#dateBitisTarihi").val(result.endDate)
                searchFunc();
            }
        });
    }

    var index = 0;
    function isLoading() {

        index++;
        if (index == 5) {

            $("#loading").attr("class", "myloading");
            index = 0;
        }
    }

    function searchFunc() {
        $("#loading").attr("class", "myloading-active");
        var html = `
                    <div class="col-md-6">
                                        <table class="table table-hover table-sm table-striped shadow" style="width:100%" id="satisKanallarinaGore">
                                            <caption><b>Satış Tipine Göre</b>

                                                    </caption>
                                            <thead>
                                               <tr><th>Kanal</th><th>Şube Sayısı</th><th>Miktar</th><th>Tutar</th><th>Toplama Oranı</th></tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                         </table>
 <br/><br/>
                                         <table class="table table-hover table-sm table-striped shadow" style="width:100%" id="opsiyonTipineGore">
                                            <caption><b>Opsiyon Tipine Göre</b>

                                                    </caption>
                                            <thead>
                                               <tr><th>Opsiyon</th><th>Şube Sayısı</th><th>Miktar</th><th>Tutar</th></tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                         </table>
 <br/><br/>
                                         <table class="table table-hover table-sm table-striped shadow" style="width:100%" id="onlinePlatformlaraGore">
                                            <caption><b>Online Platformlara Göre</b>

                                                    </caption>
                                            <thead>
                                               <tr><th>Platform</th><th>Şube Sayısı</th><th>Miktar</th><th>Tutar</th><th>Toplama Oranı</th></tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                         </table>
 <br/><br/>
                                         <table class="table table-hover table-sm table-striped shadow " style="width:100%;display:none" id="tahsilatTiplerineGore">
                                            <caption><b>Tahsilat Tiplerine Göre</b>

                                                    </caption>
                                            <thead>
                                               <tr><th>Tip</th><th>Şube Sayısı</th><th>Miktar</th><th>Tutar</th><th>Toplama Oranı</th></tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                         </table>
                    </div>
                    <div class="col-md-6">
                                        <table class="table table-hover table-sm table-striped shadow" style="width:100%" id="subelereGore">
                                            <caption><b>Şubelere Göre</b>

                                                    </caption>
                                            <thead>
                                               <tr><th>Şube Adı</th><th>Miktar</th><th>Tutar</th><th>Toplama Oranı</th></tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                         </table>
 <br/><br/>
                                         <table class="table table-hover table-sm table-striped shadow" style="width:100%" id="urunlereGore">
                                            <caption><b>Ürünlere Göre</b>

                                                    </caption>
                                            <thead>
                                               <tr><th>Ürün Adı</th><th>Miktar</th><th>Tutar</th><th>Toplama Oranı</th></tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                         </table>
                    </div>
                   

                `;
        $("#tableDiv").html(html);


        searchFilterShow();

        satisKanallarinaGore();
        opsiyonTipineGore();
        onlinePlatformlaraGore();
        //tahsilatTiplerineGore();
        subelereGore();
        urunlereGore();
    }

    function searchFilterShow() {
        $("#subelereGore caption").html("");
        $("#onlinePlatformlaraGore caption").html("");
        $("#urunlereGore caption").html("");
        $("#tahsilatTiplerineGore caption").html("");
        $("#opsiyonTipineGore caption").html("");
        $("#satisKanallarinaGore caption").html("");

        if (SUBEADI != "") {
            $("#subelereGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="SUBEADI=''; searchFilterShow();">
                         Temizle <span class="badge badge-danger">x</span>
                         </button>
                 `);

            for (var i = 0; i < SUBEADI.split(',').length - 1; i++) {

                $("#subelereGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="SUBEADI='`+ SUBEADI.split(SUBEADI.split(',')[i] + ",").join("") + `'; searchFilterShow();">
                         `+ SUBEADI.split(',')[i] + ` <span class="badge badge-danger">x</span>
                         </button>
                 `);

            }
           
        }
        if (KANAL != "") {
            $("#onlinePlatformlaraGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="KANAL=''; searchFilterShow();">
                         Temizle <span class="badge badge-danger">x</span>
                         </button>
                 `);

            for (var i = 0; i < KANAL.split(',').length - 1; i++) {

                $("#onlinePlatformlaraGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="KANAL='`+ KANAL.split(KANAL.split(',')[i] + ",").join("") + `'; searchFilterShow();">
                         `+ KANAL.split(',')[i] + ` <span class="badge badge-danger">x</span>
                         </button>
                 `);

            }


        }
        if (URUNADI != "") {
            $("#urunlereGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="URUNADI=''; searchFilterShow();">
                         Temizle <span class="badge badge-danger">x</span>
                         </button>
                 `);

            for (var i = 0; i < URUNADI.split(',').length - 1; i++) {

                $("#urunlereGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="URUNADI='`+ URUNADI.split(URUNADI.split(',')[i] + ",").join("") + `'; searchFilterShow();">
                         `+ URUNADI.split(',')[i] + ` <span class="badge badge-danger">x</span>
                         </button>
                 `);

            }
        
        }
        if (ODEMETIPI != "") {
            $("#tahsilatTiplerineGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="ODEMETIPI=''; searchFilterShow();">
                         Temizle <span class="badge badge-danger">x</span>
                         </button>
                 `);

            for (var i = 0; i < ODEMETIPI.split(',').length - 1; i++) {

                $("#tahsilatTiplerineGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="ODEMETIPI='`+ ODEMETIPI.split(ODEMETIPI.split(',')[i] + ",").join("") + `'; searchFilterShow();">
                         `+ ODEMETIPI.split(',')[i] + ` <span class="badge badge-danger">x</span>
                         </button>
                 `);

            }
          
        }
        if (OPSIYONTIPI != "") {
            $("#opsiyonTipineGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="OPSIYONTIPI=''; searchFilterShow();">
                         Temizle <span class="badge badge-danger">x</span>
                         </button>
                 `);

            for (var i = 0; i < OPSIYONTIPI.split(',').length - 1; i++) {

                $("#opsiyonTipineGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="OPSIYONTIPI='`+ OPSIYONTIPI.split(OPSIYONTIPI.split(',')[i] + ",").join("") + `'; searchFilterShow();">
                         `+ OPSIYONTIPI.split(',')[i] + ` <span class="badge badge-danger">x</span>
                         </button>
                 `);

            }
           
        }
        if (SATISTIPI != "") {
            $("#satisKanallarinaGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="SATISTIPI=''; searchFilterShow();">
                         Temizle <span class="badge badge-danger">x</span>
                         </button>
                 `);

            for (var i = 0; i < SATISTIPI.split(',').length - 1; i++) {

                $("#satisKanallarinaGore caption").append(`
                        <button type="button" class="btn btn-danger btn-sm" onclick="SATISTIPI='`+ SATISTIPI.split(SATISTIPI.split(',')[i] + ",").join("") + `'; searchFilterShow();">
                         `+ SATISTIPI.split(',')[i] + ` <span class="badge badge-danger">x</span>
                         </button>
                 `);

            }
          
        }


    }

    function satisKanallarinaGore() {
        var theData = {
            StartDate: $("#dateGecerlilikTarihi").val(),
            EndDate: $("#dateBitisTarihi").val(),
            URUNADI: URUNADI,
            KANAL: KANAL,
            SUBEADI: SUBEADI,
            ODEMETIPI: ODEMETIPI,
            SATISTIPI: SATISTIPI,
            OPSIYONTIPI: OPSIYONTIPI
        }
        $("#satisKanallarinaGore tbody").html("");
        $.ajax({
            url: '/OnlineSatislarAnalizi/SatisKanallarinaGore',
            type: 'GET',
            beforeSend: function (request) {

            },
            complete: function (data) {
                isLoading()
            },
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    $("#satisKanallarinaGore tbody").append("<tr onclick=' SATISTIPI = \"" + result[i]["Kanal"] + ",\"; searchFilterShow();'><td>" + result[i]["Kanal"] + "</td><td class='text-right'>" + (result[i]["SubeSayiyi"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Miktar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Tutar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Oran"]) + "</td></tr>");
                }
                runDatatable("satisKanallarinaGore");

              
            }
        });
    }

    function opsiyonTipineGore() {
        var theData = {
            StartDate: $("#dateGecerlilikTarihi").val(),
            EndDate: $("#dateBitisTarihi").val(),
            URUNADI: URUNADI,
            KANAL: KANAL,
            SUBEADI: SUBEADI,
            ODEMETIPI: ODEMETIPI,
            SATISTIPI: SATISTIPI,
            OPSIYONTIPI: OPSIYONTIPI
        }
        $("#opsiyonTipineGore tbody").html("");
        $.ajax({
            url: '/OnlineSatislarAnalizi/OpsiyonTipineGore',
            type: 'GET',
            beforeSend: function (request) {

            },
            complete: function (data) {
                isLoading()
            },
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    $("#opsiyonTipineGore tbody").append("<tr><td>" + result[i]["TIP"] + "</td><td class='text-right'>" + (result[i]["SubeSayiyi"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Miktar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Tutar"]) + "</td></tr>");
                }
                runDatatable("opsiyonTipineGore");


            }
        });
    }

    function tahsilatTiplerineGore() {
        var theData = {
            StartDate: $("#dateGecerlilikTarihi").val(),
            EndDate: $("#dateBitisTarihi").val(),
            URUNADI: URUNADI,
            KANAL: KANAL,
            SUBEADI: SUBEADI,
            ODEMETIPI: ODEMETIPI,
            SATISTIPI: SATISTIPI,
            OPSIYONTIPI: OPSIYONTIPI
        }
        $("#tahsilatTiplerineGore tbody").html("");
        $.ajax({
            url: '/OnlineSatislarAnalizi/TahsilatTiplerineGore',
            type: 'GET',
            beforeSend: function (request) {

            },
            complete: function (data) {
                isLoading()
            },
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    $("#tahsilatTiplerineGore tbody").append("<tr onclick=' ODEMETIPI += \"" + result[i]["Odemetipi"] + ",\"; searchFilterShow();'><td>" + result[i]["Odemetipi"] + "</td><td class='text-right'>" + (result[i]["SubeSayiyi"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Miktar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Tutar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Oran"]) + "</td></tr>");
                }
                runDatatable("tahsilatTiplerineGore");


            }
        });
    }

    function onlinePlatformlaraGore() {
        var theData = {
            StartDate: $("#dateGecerlilikTarihi").val(),
            EndDate: $("#dateBitisTarihi").val(),
            URUNADI: URUNADI,
            KANAL: KANAL,
            SUBEADI: SUBEADI,
            ODEMETIPI: ODEMETIPI,
            SATISTIPI: SATISTIPI,
            OPSIYONTIPI: OPSIYONTIPI
        }
        $("#onlinePlatformlaraGore tbody").html("");
        $.ajax({
            url: '/OnlineSatislarAnalizi/OnlinePlatformlaraGore',
            type: 'GET',
            beforeSend: function (request) {

            },
            complete: function (data) {
                isLoading()
            },
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    $("#onlinePlatformlaraGore tbody").append("<tr onclick=' KANAL += \"" + result[i]["Kanal"] + ",\"; searchFilterShow();'><td>" + result[i]["Kanal"] + "</td><td class='text-right'>" + (result[i]["SubeSayiyi"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Miktar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Tutar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Oran"]) + "</td></tr>");
                }
                runDatatable("onlinePlatformlaraGore");


            }
        });
    }

    function subelereGore() {
        var theData = {
            StartDate: $("#dateGecerlilikTarihi").val(),
            EndDate: $("#dateBitisTarihi").val(),
            URUNADI: URUNADI,
            KANAL: KANAL,
            SUBEADI: SUBEADI,
            ODEMETIPI: ODEMETIPI,
            SATISTIPI: SATISTIPI,
            OPSIYONTIPI: OPSIYONTIPI
        }
        $("#subelereGore tbody").html("");
        $.ajax({
            url: '/OnlineSatislarAnalizi/SubelereGore',
            type: 'GET',
            beforeSend: function (request) {

            },
            complete: function (data) {
                isLoading()
            },
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    $("#subelereGore tbody").append("<tr onclick=' SUBEADI += \"" + result[i]["Kanal"] + ",\"; searchFilterShow();'><td>" + result[i]["Kanal"] + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Miktar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Tutar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Oran"]) + "</td></tr>");
                }
                runDatatable("subelereGore");


            }
        });
    }

    function urunlereGore() {
        var theData = {
            StartDate: $("#dateGecerlilikTarihi").val(),
            EndDate: $("#dateBitisTarihi").val(),
            URUNADI: URUNADI,
            KANAL: KANAL,
            SUBEADI: SUBEADI,
            ODEMETIPI: ODEMETIPI,
            SATISTIPI: SATISTIPI,
            OPSIYONTIPI: OPSIYONTIPI
        }
        $("#urunlereGore tbody").html("");
        $.ajax({
            url: '/OnlineSatislarAnalizi/UrunlereGore',
            type: 'GET',
            beforeSend: function (request) {

            },
            complete: function (data) {
                isLoading()
            },
            dataType: 'text',
            data: theData,
            success: function (data) {
                var result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    $("#urunlereGore tbody").append("<tr onclick=' URUNADI += \"" + result[i]["Kanal"] + ",\"; searchFilterShow();'><td>" + result[i]["Kanal"] + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Miktar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Tutar"]) + "</td><td class='text-right'>" + " " + formatCurrency(result[i]["Oran"]) + "</td></tr>");
                }
                runDatatable("urunlereGore");


            }
        });
    }


</script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>