@model SefimV2.ViewModels.SPosKabulIslemleri.BelgeAlisGiderCreate

@{
    Layout = "~/Views/Shared/_LayoutPageSPos.cshtml";
}
<style>
    .select2.select2-container.select2-container--default.select2-container--focus {
        width: 100%;
    }
</style>
<link href="~/Content/ContentSefPanel/css/costomfieldset/customfielset.css" rel="stylesheet" />
@*<h2>@Html.EnumDropDownListFor(model => model.BelgeTip, new { @disabled = "disabled" })</h2>*@
<div class="col-md-12">@Html.HiddenFor(model => model.Cari, new { @id = "CariID", @class = "form-control" })</div>

@using (Ajax.BeginForm("AlisBelgesiCreateInsert", "SefimPanelBelgeIslemleri", FormMethod.Post, new AjaxOptions { OnSuccess = "OnSuccess", OnBegin = "OnBegin", OnComplete = "OnComplete" }, htmlAttributes: new { @class = "m-form", @id = "AlisBelgesiCreate" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(false, "")
    @Html.HiddenFor(m => m.Id)

    <div class="form-horizontal">
        <fieldset class="well the-fieldset margin-bottom-5 padding-bottom-10 padding-top-10">
            <legend class="the-legend"> @Html.EnumDropDownListFor(model => model.BelgeTip, new { @disabled = "disabled" })  </legend>
            <div class="form-inline row">
                <div class="form-group col-md-2">
                    <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.Tarih)</div>
                    <div class="col-md-12">
                        @*@if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.AlisFaturasi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.AlisIrsaliyesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.IadeFaturasi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.IadeIrsaliyesi)
                            {*@
                        @Html.TextBoxFor(model => model.Tarih, new { @type = "date", @class = "form-control datepicker" })
                        @*}
                            else
                            {
                                @Html.TextBoxFor(model => model.Tarih, new { @type = "date", @class = "form-control datepicker", @disabled = "" })
                            }*@

                    </div>
                </div>

                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.SablonAdi)</div>
                        <div class="col-md-12">@Html.TextBoxFor(model => model.SablonAdi, new { @class = "form-control" })</div>
                    </div>
                }
                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi)
                {
                    <div class="form-group col-md-8">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.Sablon)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Sablon, new List<SelectListItem>(), new { @id = "Sablon", @class = "form-control" })</div>
                    </div>
                }


                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="form-group col-md-2 hidden">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.BelgeNo)</div>
                        <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeNo, new { @class = "form-control" })</div>
                    </div>
                }
                else
                {
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.BelgeNo)</div>
                        <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeNo, new { @class = "form-control" })</div>
                    </div>
                }

                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="form-group col-md-2 hidden">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Personel)</div>
                        <div class="col-md-12">@Html.TextBoxFor(model => model.Personel, new { @class = "form-control" })</div>
                    </div>
                }
                else
                {
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Personel)</div>
                        <div class="col-md-12">@Html.TextBoxFor(model => model.Personel, new { @class = "form-control" })</div>
                    </div>
                }

                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="form-group col-md-2 hidden">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Sube)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Sube, new List<SelectListItem>(), new { @id = "Sube", @class = "form-control m-select2" })</div>
                    </div>
                }
                else
                {
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Sube)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Sube, new List<SelectListItem>(), new { @id = "Sube", @class = "form-control m-select2" })</div>
                    </div>
                }

                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="form-group col-md-2 hidden">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Kasa)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Kasa, new List<SelectListItem>(), new { @id = "Kasa", @class = "form-control" })</div>
                    </div>
                }
                else
                {
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Kasa)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Kasa, new List<SelectListItem>(), new { @id = "Kasa", @class = "form-control" })</div>
                    </div>
                }

                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="form-group col-md-2 hidden">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Depo)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Depo, new List<SelectListItem>(), new { @id = "Depo", @disabled = "", @class = "form-control" })</div>
                    </div>
                }
                else
                {
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Depo)</div>
                        <div class="col-md-12">@Html.DropDownListFor(model => model.Depo, new List<SelectListItem>(), new { @id = "Depo", @disabled = "", @class = "form-control" })</div>
                    </div>
                }





                <div class="form-group col-md-2">
                    @*<div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(m => m.Kdv)</div>
                        <div class="col-md-12">@Html.CheckBoxFor(model => model.Kdv, new { @class = "form-control" })</div>*@
                </div>

            </div>

            @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
            {
                <div class="form-inline row hidden">
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.BelgeOzelKod1)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod1, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod1, new List<SelectListItem>(), new { @id = "BelgeOzelKod1", @disabled = "", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.BelgeOzelKod2)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod2, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod2, new List<SelectListItem>(), new { @id = "BelgeOzelKod2", @disabled = "", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.BelgeOzelKod3)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod3, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod3, new List<SelectListItem>(), new { @id = "BelgeOzelKod3", @disabled = "", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.BelgeOzelKod4)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod4, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod4, new List<SelectListItem>(), new { @id = "BelgeOzelKod4", @disabled = "", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.OzelKod)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod4, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.OzelKod, new List<SelectListItem>(), new { @id = "OzelKod", @disabled = "", @class = "form-control" })</div>
                    </div>
                </div>
            }
            else
            {
                <div class="form-inline row">
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.BelgeOzelKod1)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod1, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod1, new List<SelectListItem>(), new { @id = "BelgeOzelKod1", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(model => model.BelgeOzelKod2)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod2, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod2, new List<SelectListItem>(), new { @id = "BelgeOzelKod2", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.BelgeOzelKod3)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod3, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod3, new List<SelectListItem>(), new { @id = "BelgeOzelKod3", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.BelgeOzelKod4)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod4, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeOzelKod4, new List<SelectListItem>(), new { @id = "BelgeOzelKod4", @class = "form-control" })</div>
                    </div>
                    <div class="form-group col-md-2">
                        <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.OzelKod)</div>
                        @*<div class="col-md-12">@Html.TextBoxFor(model => model.BelgeOzelKod4, new { @class = "form-control" })</div>*@
                        <div class="col-md-12">@Html.DropDownListFor(model => model.OzelKod, new List<SelectListItem>(), new { @id = "OzelKod", @class = "form-control" })</div>
                    </div>
                    @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.DepoTransfer)
                    {
                        <div class="form-group col-md-2">
                            <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.CikanDepo)</div>
                            <div class="col-md-12">@Html.DropDownListFor(model => model.CikanDepo, new List<SelectListItem>(), new { @id = "CikanDepo", @class = "form-control" })</div>
                        </div>
                    }
                    else if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                    {
                        <div class="form-group col-md-2">
                            <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.CikanDepo)</div>
                            <div class="col-md-12">@Html.DropDownListFor(model => model.CikanDepo, new List<SelectListItem>(), new { @id = "CikanDepo", @disabled = "", @class = "form-control" })</div>
                        </div>
                    }

                </div>

            }
            <div class="form-group col-md-2">
                <div class="araadCreateLabel control-label col-md-12">@Html.DisplayNameFor(m => m.Kdv)</div>
                <div class="col-md-12">@Html.CheckBoxFor(model => model.Kdv, new { @id = "Kdv" })</div>
            </div>
            <div class="form-group col-md-12">
                <div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(model => model.BelgeNot)</div>
                <div class="col-md-12">@Html.TextAreaFor(model => model.BelgeNot, new { @class = "form-control", @rows = "6" })</div>
            </div>
            <div class="form-group col-md-6">
                @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.TalepBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.DepoTransfer || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                {
                    <div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(model => model.Cari)</div>
                    <div class="col-md-12">@Html.DropDownListFor(model => model.Cari, new List<SelectListItem>(), new { @id = "Cari", @disabled = "", @class = "form-control m-select2" })</div>
                }
                else if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                {
                    <div class="araadCreateLabel control-label col-md-8 hidden">@Html.DisplayNameFor(model => model.Cari)</div>
                    <div class="col-md-12 hidden">@Html.DropDownListFor(model => model.Cari, new List<SelectListItem>(), new { @id = "Cari", @disabled = "", @class = "form-control m-select2" })</div>
                }
                else
                {
                    <div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(model => model.Cari)</div>
                    <div class="col-md-12">@Html.DropDownListFor(model => model.Cari, new List<SelectListItem>(), new { @id = "Cari", @class = "form-control m-select2" })</div>
                }

            </div>
            @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.AlisFaturasi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.AlisIrsaliyesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.IadeFaturasi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.IadeIrsaliyesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.GiderFaturasi)
            {
                <div class="form-group col-md-6">
                    <div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(model => model.AltCari)</div>
                    <div class="col-md-12">@Html.DropDownListFor(model => model.AltCari, new List<SelectListItem>(), new { @id = "AltCari", @class = "form-control m-select2" })</div>
                </div>
            }


            <div class="mtop20">
                <a class='btn btn-primary pull-right' id="btnbelgeHareketCreateModal" data-url="@Url.Action("BelgeStok", "SefimPanelBelgeIslemleri")"> Stok Ekle</a>
            </div>
        </fieldset>

        <fieldset class="well the-fieldset margin-bottom-5 padding-bottom-10 padding-top-10">
            <legend class="the-legend">Stok Listesi </legend>
            <div class="form-group">
                <table id="tblCustomers" class="display small table table-striped table-bordered" cellspacing="0" width="100%">
                    <tr>
                        <th style="width:150px">Stok Kodu</th>
                        <th style="width:150px">Malın Cinsi</th>
                        <th style="width:60px">Miktar</th>
                        <th style="width:60px">Birim</th>
                        @if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimSablon)
                        {
                            <th style="width:60px">Isk1</th>
                            <th style="width:60px">Isk2</th>
                            <th style="width:60px">Isk3</th>
                            <th style="width:60px">Isk4</th>
                        }

                        @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                        {
                            <th style="width:60px">Zayi Miktar</th>
                            <th style="width:60px">Açıklama</th>
                        }
                        else if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi)
                        {
                            <th style="width:60px">Açıklama</th>
                        }
                        else
                        {
                            if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                            {
                                <th style="width:60px">Kdv</th>
                                <th style="width:60px">Birim Fiyatı</th>
                            }
                        }

                        @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                        {
                            <th class="hidden" style="width:60px">Sayım Tarihi Dahil</th>
                        }
                        else
                        {
                            if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                            {
                                <th style="width:60px">Tutar</th>
                            }
                        }
                        <th style="width:100px"></th>
                    </tr>
                    <tbody id="tblCustomersObject"></tbody>
                    @{
                        if (@Model != null)
                        {
                            for (int i = 0; i < @Model.BelgeHarekets.ToList().Count(); i++)
                            {
                                <tr id="@Model.BelgeHarekets.ToList()[i].Id">
                                    <td class="Stok">
                                        <span>@Model.BelgeHarekets.ToList()[i].Stok</span>
                                    </td>
                                    <td class="MalinCinsi">
                                        <span>@Model.BelgeHarekets.ToList()[i].MalinCinsi</span>
                                    </td>
                                    <td class="Miktar">
                                        <span>@Model.BelgeHarekets.ToList()[i].Miktar</span>
                                    </td>

                                    @if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimSablon)
                                    {
                                        <td class="Birim">
                                            <span>@Model.BelgeHarekets.ToList()[i].Birim</span>
                                        </td>
                                        <td class="Isk1">
                                            <span>@Model.BelgeHarekets.ToList()[i].Isk1</span>
                                        </td>
                                        <td class="Isk2">
                                            <span>@Model.BelgeHarekets.ToList()[i].Isk2</span>
                                        </td>
                                        <td class="Isk3">
                                            <span>@Model.BelgeHarekets.ToList()[i].Isk3</span>
                                        </td>
                                        <td class="Isk4">
                                            <span>@Model.BelgeHarekets.ToList()[i].Isk4</span>
                                        </td>
                                    }

                                    @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                                    {
                                        <td class="ZayiMiktar">
                                            <span>@Model.BelgeHarekets.ToList()[i].ZayiMiktar</span>
                                        </td>
                                        <td class="Aciklama">
                                            <span>@Model.BelgeHarekets.ToList()[i].Aciklama</span>
                                        </td>
                                    }
                                    else if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi)
                                    {
                                        <td class="Aciklama">
                                            <span>@Model.BelgeHarekets.ToList()[i].Aciklama</span>
                                        </td>
                                    }
                                    else
                                    {
                                        if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                                        {
                                            <td class="KDV">
                                                <span>@Model.BelgeHarekets.ToList()[i].KDV</span>
                                            </td>

                                            <td class="Fiyat">
                                                <span>@Model.BelgeHarekets.ToList()[i].Fiyat</span>
                                            </td>
                                        }
                                    }


                                    @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                                    {
                                        <td class="SayimTarihDahil hidden">
                                            <span>@Model.BelgeHarekets.ToList()[i].SayimTarihDahil</span>
                                        </td>
                                    }
                                    else
                                    {
                                        if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                                        {
                                            <td class="Tutar">
                                                <span>@Model.BelgeHarekets.ToList()[i].Tutar</span>
                                            </td>
                                        }
                                    }

                                    <td>
                                        <a class="btn btn-warning" onclick="lib.OpenModal(@Model.BelgeHarekets.ToList()[i].Id)" title="Ürün bilgilerini güncelle">
                                            Düzenle
                                        </a>
                                        @if (Model.OnayDurumu == 0)
                                        {
                                            <a class="btn btn-danger" onclick="lib.Clear(@Model.BelgeHarekets.ToList()[i].Id)" title="Ürünü sil">
                                                Sil
                                            </a>
                                        }
                                    </td>
                                </tr>
                            }
                        }
                    }
                </table>
            </div>
            <div class="form-group  text-align-center">
                @*@Html.Back()*@
                @if (Model.OnayDurumu == 0)
                {

                    <input value="Kaydet" class="btn btn-success pull-right btnKaydet" onclick="lib.Kaydet()" />
                    if (Model.Id > 0 && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimSablon)
                    {
                        <a class="btn btn-primary pull-right" onclick="lib.onayla(@Model.Id)" title="Kaydet ve Onayla">
                            Kaydet ve Onayla
                        </a>
                    }
                }
            </div>
        </fieldset>
    </div>

    <div class="modal fade bs-example-modal-lg" id="belgeHareketCreateModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    @*  <span class="modal-title" id="@headerText"></span>*@
                    <a class="pull-right txt-color-white" data-dismiss="modal" aria-label="Close" title="Kapat">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </a>
                </div>
                <div class="modal-body padding-12" style="overflow-y:auto;max-height:600px">
                    <div class="m-content">
                        <div class="row" style="margin:10px">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div id="notification"></div>
                                    </div>
                                </div>
                                <div class="m-portlet">
                                    <div class="m-subheader margin-bottom-10">
                                        <div class="d-flex align-items-center">
                                            <div class="mr-auto">
                                                <h2 class="m-subheader__title m-subheader__title--separator" style="text-align:center;margin-top:1px;margin-bottom:1px">Stok İşlemleri</h2>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                @Html.HiddenFor(m => m.BelgeHarekets.FirstOrDefault().Id, new { @id = "StokId" })
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().MalinCinsi)</div>
                                        <div class="col-md-12">@Html.DropDownListFor(model => Model.BelgeHarekets.FirstOrDefault().MalinCinsi, new List<SelectListItem>(), new { @id = "MalinCinsi", @class = "form-control m-select2", @style = "width:820px" })</div>
                                    </div>
                                    <div class="form-group">
                                        <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Birim)</div>
                                        <div class="col-md-12">@Html.DropDownListFor(model => model.BelgeHarekets.FirstOrDefault().Birim, new List<SelectListItem>(), new { @disabled = "", @id = "Birim", @class = "form-control m-select2", @style = "width:820px" })</div>
                                    </div>



                                    @if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi || Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.SayimSablon)
                                    {
                                        <div class="form-group">
                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Miktar)</div>
                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Miktar, new { @id = "Miktar", @class = "form-control decimal_input" })</div>
                                        </div>
                                        <div class="form-group">
                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().ZayiMiktar)</div>
                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().ZayiMiktar, new { @id = "ZayiMiktar", @class = "form-control decimal_input" })</div>
                                        </div>
                                        <div class="form-group">
                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Aciklama)</div>
                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Aciklama, new { @id = "Aciklama", @class = "form-control" })</div>
                                        </div>
                                        <div class="form-group hidden">
                                            <div class="araadCreateLabel control-label col-md-8">@Html.DisplayNameFor(model => model.BelgeHarekets.FirstOrDefault().SayimTarihDahil)</div>
                                            <div class="col-md-12">@Html.CheckBoxFor(model => model.BelgeHarekets.FirstOrDefault().SayimTarihDahil, new { @class = "form-control" })</div>
                                        </div>

                                    }
                                    else if (Model.BelgeTip == SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi)
                                    {
                                        <div class="form-group">
                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Miktar)</div>
                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Miktar, new { @id = "Miktar", @class = "form-control decimal_input" })</div>
                                        </div>
                                        <div class="form-group">
                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Aciklama)</div>
                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Aciklama, new { @id = "Aciklama", @class = "form-control" })</div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="form-group">
                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Miktar)</div>
                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Miktar, new { @id = "Miktar", @class = "form-control decimal_input" })</div>
                                        </div>
                                        if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                                        {
                                            <div class="form-group">
                                                <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Fiyat)</div>
                                                <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Fiyat, new { @id = "Fiyat", @class = "form-control decimal_input" })</div>
                                            </div>
                                        }

                                        if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul)
                                        {

                                            if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimSablon)
                                            {
                                                <div class="col-sm-12">
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk1)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk1, new { @id = "Isk1", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk2)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk2, new { @id = "Isk2", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk3)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk3, new { @id = "Isk3", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk4)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk4, new { @id = "Isk4", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                            <div class="form-group">
                                                <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().KDV)</div>
                                                <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().KDV, new { @id = "KDV", @disabled = "", @class = "form-control decimal_input" })</div>
                                            </div>
                                            <div class="form-group">
                                                <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Tutar)</div>
                                                <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Tutar, new { @id = "Tutar", @disabled = "", @class = "form-control decimal_input" })</div>
                                            </div>
                                        }
                                        else
                                        {

                                            if (Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.ZayiGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.TalepBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransfer && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.DepoTransferKabul && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimGirisBelgesi && Model.BelgeTip != SefimV2.Enums.General.BelgeTipi.SayimSablon)
                                            {
                                                <div class="col-sm-12">
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk1)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk1, new { @id = "Isk1", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk2)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk2, new { @id = "Isk2", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk3)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk3, new { @id = "Isk3", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <div class="form-group">
                                                            <div class="araadCreateLabel control-label col-md-4">@Html.DisplayNameFor(m => m.BelgeHarekets.FirstOrDefault().Isk4)</div>
                                                            <div class="col-md-12">@Html.TextBoxFor(model => model.BelgeHarekets.FirstOrDefault().Isk4, new { @id = "Isk4", @class = "form-control decimal_input" })</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    }

                                </div>
                                <div class="col-md-offset-5 col-md-7">
                                    <button type="button" class="btn btn-default" id="btnclose" data-dismiss="modal">Close</button>
                                    @if (Model.OnayDurumu == 0)
                                    {
                                        <input value="Kaydet" class="btn btn-success btnStokKaydet" onclick="lib.StokKaydet()" />
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@*<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>*@

 <link href="~/Scripts/AlisScript/select2.min.css" rel="stylesheet" />
<script src="~/Scripts/AlisScript/jquery.min.js"></script>
<script src="~/Scripts/AlisScript/select2.min.js"></script>

<script type="text/javascript">
    $(function () {
        $("#Cari").select2({ width: "100%" });
        $("#BelgeOzelKod1").select2({ width: "100%" });
        $("#BelgeOzelKod2").select2({ width: "100%" });
        $("#BelgeOzelKod3").select2({ width: "100%" });
        $("#BelgeOzelKod4").select2({ width: "100%" });
        $("#OzelKod").select2({ width: "100%" });
        $("#AltCari").select2({ width: "100%" });
    });
</script>
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script>



    $('#Tarih').val(new Date().format('yyyy-MM-dd'))
    //kullanıcının subeid, depoid, cariid bilgileri alınıyor
    var user;
    $.ajax({
        url: '/User/UserJson',
        type: 'GET',
        beforeSend: function (request) {
            //mApp.blockPage();
        },
        complete: function () {
            window.setTimeout(function () {
                //mApp.unblockPage();
            }, 100);
        },
        dataType: 'json',
        success: function (data) {
            user = data;
            SubeList();
            DepoList();
            HereketDepoList();
            CariList();
            StokList();
            KasaList();
            SablonList();
            BelgeOzelKod1();
            BelgeOzelKod2();
            BelgeOzelKod3();
            BelgeOzelKod4();
            BelgeOzelKod5();
        }
    });

    var lib = {};
    var alisbelgesi = {};
    alisbelgesi.BelgeHarekets = [];
    lib.documentReadyStatusList = {
        Sube: false,
        Depo: false,
        HareketDepo: false,
        Cari: false,
        Stok: false,
        Kasa: false,
        OzelKod1: false,
        OzelKod2: false,
        OzelKod3: false,
        OzelKod4: false,
        OzelKod5: false,
        Sablon: false
    };

    lib.DocumentReadyControl = function () {
        var snc = false;
        Object.keys(lib.documentReadyStatusList).forEach(function (k, index) {
            if (!lib.documentReadyStatusList[k]) {
                console.log(false)
                return false;
            }
            if (index == Object.keys(lib.documentReadyStatusList).length - 1) {
                console.log(true)
                snc = true;
            }
        })
        return snc;
    }






    lib.StokKaydet = function () {
        var obj = {};
        if ($('#StokId').val()) {
            lib.Clear($('#StokId').val());
            obj.Id = $('#StokId').val();
        } else {
            obj.Id = ((alisbelgesi.BelgeHarekets.length || 0) * (-1)) - 1;
        }

        if ($('#MalinCinsi').val()==0) {
            return alert("Lütfen öncelikle Ürün seçiniz.")
        }
        if (!$('#Miktar').val() && $('#BelgeTip').val()!=255) {//Sayım şablonu değilse miktar zorunlu değil
            return alert("Lütfen miktar giriniz.")
        }

        obj.Stok = $('#MalinCinsi').val();
        obj.MalinCinsi = $("#MalinCinsi option:selected").text();
        if ($('#Miktar').val())
        obj.Miktar = "" + $('#Miktar').val().replace('.', ',');
        obj.Birim = $("#Birim option:selected").text();
        if ($('#Isk1').val())
            obj.Isk1 = "" + $('#Isk1').val().replace('.', ',');
        if ($('#Isk2').val())
            obj.Isk2 = "" + $('#Isk2').val().replace('.', ',');
        if ($('#Isk3').val())
            obj.Isk3 = "" + $('#Isk3').val().replace('.', ',');
        if ($('#Isk4').val())
            obj.Isk4 = "" + $('#Isk4').val().replace('.', ',');

        if ($('#BelgeTip').val() == 20 || $('#BelgeTip').val() == 26 || $('#BelgeTip').val()==165) {
            if (!obj.Isk1) obj.Isk1 = 0;
            if (!obj.Isk2) obj.Isk2 = 0;
            if (!obj.Isk3) obj.Isk3 = 0;
            if (!obj.Isk4) obj.Isk4 = 0;
        }

        if ($('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 255) {
            obj.ZayiMiktar = $('#ZayiMiktar').val();
            obj.Aciklama = $('#Aciklama').val();
        } else if ($('#BelgeTip').val() == 94) {
            obj.Aciklama = $('#Aciklama').val();
        } else {
            if ($('#BelgeTip').val() != 135 && $('#BelgeTip').val() != 128 && $('#BelgeTip').val() != 129) {//Talep belgesi / DepoTransfer / DepoTransferKabul
                obj.KDV = $('#KDV').val().replace('.', ',');
                obj.Fiyat = $('#Fiyat').val().replace('.',',');
            }
        }

        if ($('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 94 || $('#BelgeTip').val() == 255) {
            if ($('#SayimTarihDahil:checked').val()) {
                obj.SayimTarihDahil = $('#SayimTarihDahil:checked').val();
            } else {
                obj.SayimTarihDahil = false;
            }
        } else {
            if ($('#BelgeTip').val() != 135 && $('#BelgeTip').val() != 128 && $('#BelgeTip').val() != 129) {//Talep belgesi / DepoTransfer / DepoTransferKabul
                obj.Tutar = $('#Tutar').val().replace('.', ',');
            }
        }
        alisbelgesi.BelgeHarekets.push(obj);
        var tr = $('<tr id=' + obj.Id + '></tr>');
        Object.keys(obj).forEach(function (keys) {
            if (keys != "Id") {
                if (keys != "SayimTarihDahil") {
                    var td = $('<td class=' + keys + '></td>');
                    td.append(obj[keys].toString());
                    tr.append(td);
                } else {
                    var td = $('<td class=' + keys+' hidden' + '></td>');
                    td.append(obj[keys].toString());
                    tr.append(td);
                }

            }
        })

        var buttontd = $('<td></td>');
        buttontd.append($('<a class="btn btn-warning" onclick="lib.OpenModal(' + obj.Id + ')" title="Ürün bilgilerini güncelle">Düzenle</a>'))
        buttontd.append($(' <a class="btn btn-danger" onclick="lib.Clear(' + obj.Id + ')" title="Ürünü sil">Sil</a>'))




        tr.append(buttontd);

        $('#tblCustomersObject').append(tr);
        lib.modalclear();
        //$('#btnclose').click();
    }


    lib.Clear = function (id) {
        $("#" + id).remove();
        if (alisbelgesi.BelgeHarekets.findIndex(item => item.Id == id) > -1) {
            alisbelgesi.BelgeHarekets.splice(alisbelgesi.BelgeHarekets.findIndex(item => item.Id == id), 1)
        }
    }


    lib.Kaydet = function () {
        if (!lib.DocumentReadyControl()) {
            return alert("Lütfen sayfanın yüklenmesini bekleyin.")
        }
        if (alisbelgesi.BelgeHarekets.length > 0) {
            alisbelgesi.Id = $('#Id').val();
            alisbelgesi.BelgeTip = $('#BelgeTip').val();
            alisbelgesi.Tarih = $('#Tarih').val();
            alisbelgesi.BelgeNo = $('#BelgeNo').val();
            alisbelgesi.Personel = $('#Personel').val();
            alisbelgesi.Sube = $('#Sube').val();
            alisbelgesi.Kdv = $('#Kdv').val();
            alisbelgesi.BelgeOzelKod1 = $('#BelgeOzelKod1').val();
            alisbelgesi.BelgeOzelKod2 = $('#BelgeOzelKod2').val();
            alisbelgesi.BelgeOzelKod3 = $('#BelgeOzelKod3').val();
            alisbelgesi.BelgeOzelKod4 = $('#BelgeOzelKod4').val();
            alisbelgesi.OzelKod = $('#OzelKod').val();
            alisbelgesi.Depo = $('#Depo').val();
            alisbelgesi.CikanDepo = $('#CikanDepo').val();
            alisbelgesi.BelgeNot = $('#BelgeNot').val();
            alisbelgesi.Cari = $('#Cari').val();
            var options = $('#AltCari');
            if ($('option', options).length>1) {
                if (!$('#AltCari').val()) {
                    return alert("Lütfen alt cari kartı seçiniz.")
                }
            }

            alisbelgesi.AltCari = $('#AltCari').val();
            alisbelgesi.Kdv = $('#Kdv')[0].checked;
            if ($('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 94 || $('#BelgeTip').val() == 255 || $('#BelgeTip').val() == 128 || $('#BelgeTip').val() ==129) {
                alisbelgesi.Cari = 1;
            }
            alisbelgesi.Kasa = $('#Kasa').val();
            alisbelgesi.SablonAdi = $('#SablonAdi').val();
            alisbelgesi.Sablon = $('#Sablon').val();
            alisbelgesi.BelgeTutar = 0;
            alisbelgesi.BelgeHarekets.forEach(function (har) {
                if (har.Tutar)
                alisbelgesi.BelgeTutar += parseFloat( har.Tutar.replace(',', '.'));
            })
            alisbelgesi.BelgeTutar = alisbelgesi.BelgeTutar.toString().replace('.', ',')
            $.ajax({
                type: "POST",
                url: '/SefimPanelBelgeIslemleri/AlisBelgesiCreateInsert',
                data: alisbelgesi,
                success: function (data) {
                    console.log(data)
                     if ('@Model.Page') {
                        location.href ='@Model.Page'
                     } else {
                         if ($('#BelgeTip').val() == 255) {
                             location.href = "/SefimPanelBelgeIslemleri/AlisBelgesiSablonList";
                         } else {
                             location.href = "/SefimPanelBelgeIslemleri/AlisBelgesiList";
                         }

                    }
                    //alert("Kayıt başarılı.");
                },
                error: function (err) {
                    console.log(err)
                    alert("Bilgi eklenemedi.");
                }
            });
        } else {
            alert("Lütfen öncelikle Stok ekleyiniz.");
        }
    }

    lib.OpenModal = function (Id) {
        if ($('#Cari').val() > 0) {
            var target = $(this).data('target')
            $('#btnbelgeHareketCreateModal').data('target', target);
            $('#belgeHareketCreateModal').modal().show();
            lib.modalclear(Id);
            lib.modalfill(Id)
        } else {
            if ($('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 94 || $('#BelgeTip').val() == 255 || $('#BelgeTip').val() == 128 || $('#BelgeTip').val() ==129) {
                $('#Cari').val(1);
                var target = $(this).data('target')
                $('#btnbelgeHareketCreateModal').data('target', target);
                $('#belgeHareketCreateModal').modal().show();
                lib.modalclear(Id);
                lib.modalfill(Id)
            } else {
                alert("Öncelikle geçerli bir cari seçiniz")
            }
        }

    }
    //$(".btnAddStok").on("click", function () {
    //    //$('#genericModal').find(".modal-body").html("");
    //    //var dataurl = $(this).data("url");
    //    //callModalPage(dataurl, "Stok Ekle");
    //    //showProgressBar();
    //    //$("#modalPleaseWait").on('shown.bs.modal', function () {
    //    //});
    //});
    lib.modalfill = function (Id) {
        $('#StokId').val(Id);
        var datas = {};
        $('#' + Id).find('td').each(function (columnnum, data) {
            datas[data.className] = data.innerText;

        })

            if (datas.SayimTarihDahil == 'True') {
                $('#SayimTarihDahil').prop("checked", true);
            } else {
                $('#SayimTarihDahil').prop("checked", false);
            }
        $('#MalinCinsi').val(datas.Stok).trigger('change');
        $('#Isk1').val(datas.Isk1).trigger('change');
        $('#Isk2').val(datas.Isk2).trigger('change');
        $('#Isk3').val(datas.Isk3).trigger('change');
        $('#Isk4').val(datas.Isk4).trigger('change');
        setTimeout(function () {
            $('#Fiyat').val(datas.Fiyat).trigger('change');
            $('#Miktar').val(datas.Miktar).trigger('change');
            $('#KDV').val(datas.KDV).trigger('change');
            $('#Tutar').val(datas.Tutar).trigger('change');
        }, 1000)



        //console.log("dat:",datas)
    }
    lib.modalclear = function (Id) {
        if (Id) {
            $('#StokId').val(0);
        } else {
            $('#StokId').val(((alisbelgesi.BelgeHarekets.length || 0) * (-1)) - 1);
        }

        $('#MalinCinsi').val("0").trigger('change');
        $('#Miktar').val("");
        $('#KDV').val("");
        $('#Fiyat').val("");
        $('#Tutar').val("");
        $('#Aciklama').val("");
        $('#Isk1').val("");
        $('#Isk2').val("");
        $('#Isk3').val("");
        $('#Isk4').val("");
    }
    $('#btnbelgeHareketCreateModal').on('click', function () {
        if ($('#Cari').val() > 0) {
            event.preventDefault();
            var target = $(this).data('target')
            $('#btnbelgeHareketCreateModal').data('target', target);
            $('#belgeHareketCreateModal').modal().show();
            lib.modalclear();
        } else {
            if ($('#BelgeTip').val() != 93 && $('#BelgeTip').val() != 94 && $('#BelgeTip').val() != 255 && $('#BelgeTip').val() != 128 && $('#BelgeTip').val() !=129) {
                alert("Öncelikle geçerli bir cari seçiniz")
            }
            else {
                event.preventDefault();
                var target = $(this).data('target')
                $('#btnbelgeHareketCreateModal').data('target', target);
                $('#belgeHareketCreateModal').modal().show();
                lib.modalclear();
            }
        }
    });







    $('.btnbelgeHareketCreateModal').on('click', function () {
        event.preventDefault();
        var form = $('form');
        var target = $(this).data('target')
        $.ajax({
            type: "POST",
            url: 'Form',
            data: form.serialize(),
            success: function (data) {
                debugger;
                var result = $(data).find('#' + target).html();
                $('#' + target).html(result);
                $('#belgeHareketCreateModal').modal('hide');
                $('#btnAddStok').data('target', null);
            },
            error: function () {
                alert("Bilgi eklenemedi.");
            }
        });
    });

    function SubeList() {

            $.ajax({
                url: '/SefimPanelBelgeIslemleri/SubeListJson',
                type: 'POST',
                beforeSend: function (request) {
                    //mApp.blockPage();
                },
                complete: function () {
                    window.setTimeout(function () {
                        //mApp.unblockPage();
                    }, 100);
                },
                dataType: 'json',
                success: function (data) {
                    var options = $('#Sube');
                    $('option', options).remove();
                    /* options.append($('<option />').val(0).text("Seçiniz"));*/
                    $.each(data, function () {
                        if ('@Model.Sube') {
                            if ('@Model.Sube' == this.Value)
                                options.append($('<option />').val(this.Value).text(this.Text));
                            $('#Sube')[0].setAttribute('disabled', '');
                        } else {
                            if (user.FasterSubeID && user.FasterSubeID == this.Value) {

                                options.append($('<option />').val(this.Value).text(this.Text));
                            } else {
                                options.append($('<option />').val(this.Value).text(this.Text));
                            }

                        }

                    });
                    //console.log('@Model.Sube', user.FasterSubeID)
                    if ('@Model.Sube') {
                        $('#Sube').val('@Model.Sube').trigger('change');
                    } else {
                        if (user.FasterSubeID) {
                            $('#Sube').val(user.FasterSubeID).trigger('change');
                        }
                    }
                    lib.documentReadyStatusList.Sube = true;
                }
            });

    }


    function DepoList() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/DepoListJson',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#Depo');
                $('option', options).remove();
                options.append($('<option />').val(0).text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                if ('@Model.Depo') {
                    $('#Depo').val('@Model.Depo').trigger('change');
                    } else {
                        if ('user.DepoID') {
                            $('#Depo').val(user.DepoID).trigger('change');
                        }
                    }

                @*if ($('#BelgeTip').val() == 128 || $('#BelgeTip').val() == 129) {
                    if ('@Model.Depo') {
                        $('#Depo').val('@Model.Depo').trigger('change');
                    } else {
                        if (user.DepoID) {
                            $('#Depo').val(user.DepoID).trigger('change');
                        }
                    }
                } else {
                    if (user.DepoID) {
                        $('#Depo').val(user.DepoID).trigger('change');
                    }
                }*@
                lib.documentReadyStatusList.Depo = true;
            }
        });
    }


    function HereketDepoList() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/DepoListJson',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#CikanDepo');
                $('option', options).remove();
                options.append($('<option />').val(0).text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                if ('@Model.CikanDepo') {
                    $('#CikanDepo')[0].setAttribute('disabled', '');
                    $('#CikanDepo').val('@Model.CikanDepo').trigger('change');
                }
                lib.documentReadyStatusList.HareketDepo = true;
            }
        });
    }


    function CariList() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/CariListJson',
            type: 'POST',
            data: { BelgeTip: $('#BelgeTip').val() },
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#Cari');
                $('option', options).remove();
                options.append($('<option />').val(0).text("Seçiniz"));
                var added = false;
                $.each(data, function () {

                    if ($('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 94 || $('#BelgeTip').val() == 255 || $('#BelgeTip').val() == 128 || $('#BelgeTip').val() == 129) {
                        //if (added == false) {
                        alisbelgesi.Cari = 1
                        //if (this.Value == 1) {
                        //  options.append($('<option selected/>').val(this.Value).text(this.Text));
                        // } else {
                        //     options.append($('<option/>').val(this.Value).text(this.Text));
                        // }
                        //    added = true;
                        //}
                    } else {


                        if (this.Selected) {
                            options.append($('<option selected/>').val(this.Value).text(this.Text));
                        } else {

                            if (this.Value == user.SefimPanelZimmetCagrisi) {
                                alisbelgesi.Cari = this.Value
                                options.append($('<option selected/>').val(this.Value).text(this.Text));
                                 $('#Cari').val(this.Value).trigger('change');
                            } else {
                                options.append($('<option />').val(this.Value).text(this.Text));
                            }


                        }
                    }
                    console.log('@Model.Cari',data)
                    if ('@Model.Cari') {

                        $('#Cari').val('@Model.Cari').trigger('change');
                        $('#Cari')[0].setAttribute('disabled', '');

                    }
                });
                lib.documentReadyStatusList.Cari = true;
                //if (Model.SubeID > 0) {
                //    $('#Cari').val('Model.Cari').trigger('change');
                //} else { $('#Cari').val('0').trigger('change'); }
            }
        });
    }

    function StokList() {
        if ($('#BelgeTip').val() == 165) {
            $.ajax({
                url: '/SefimPanelBelgeIslemleri/StokSelectListHizmetJson',
                type: 'POST',
                beforeSend: function (request) {
                    //mApp.blockPage();
                },
                complete: function () {
                    window.setTimeout(function () {
                        //mApp.unblockPage();
                    }, 100);
                },
                dataType: 'json',
                success: function (data) {
                    var options = $('#MalinCinsi');
                    $('option', options).remove();
                    options.append($('<option />').val(0).text("Seçiniz"));
                    $.each(data, function () {
                        options.append($('<option />').val(this.Value).text(this.Text));
                    });
                    lib.documentReadyStatusList.Stok = true;
                    //if (user.FasterSubeID) {
                    //    $('#Stok').val(user.FasterSubeID).trigger('change');
                    //}
                }
            });
        } else {
            $.ajax({
                url: '/SefimPanelBelgeIslemleri/StokSelectListJson',
                type: 'POST',
                beforeSend: function (request) {
                    //mApp.blockPage();
                },
                complete: function () {
                    window.setTimeout(function () {
                        //mApp.unblockPage();
                    }, 100);
                },
                dataType: 'json',
                success: function (data) {
                    var options = $('#MalinCinsi');
                    $('option', options).remove();
                    options.append($('<option />').val(0).text("Seçiniz"));
                    $.each(data, function () {
                        options.append($('<option />').val(this.Value).text(this.Text));
                    });
                    lib.documentReadyStatusList.Stok = true;
                    //if (user.FasterSubeID) {
                    //    $('#Stok').val(user.FasterSubeID).trigger('change');
                    //}
                }
            });
        }

    }
    function KasaList() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/KasaSelectListJson',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#Kasa');
                $('option', options).remove();
                //options.append($('<option />').val(0).text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });


                if ('@Model.Kasa') {
                    $('#Kasa').val('@Model.Kasa').trigger('change');
                    $('#Kasa')[0].setAttribute('disabled', '');
                } else {
                    if (user.FasterSubeID) {
                        $('#Kasa').val(user.FasterSubeID).trigger('change');
                    }
                }
                lib.documentReadyStatusList.Kasa = true;
            }
        });
    }


    function BelgeOzelKod1() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/BelgeOzelKod1Json',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#BelgeOzelKod1');
                $('option', options).remove();
                options.append($('<option />').val('').text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                if ('@Model.BelgeOzelKod1') {
                    $('#BelgeOzelKod1').val('@Model.BelgeOzelKod1').trigger('change');
                }
                lib.documentReadyStatusList.OzelKod1 = true;
            }
        });
    }

    function BelgeOzelKod2() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/BelgeOzelKod2Json',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#BelgeOzelKod2');
                $('option', options).remove();
                options.append($('<option />').val('').text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                 if ('@Model.BelgeOzelKod2') {
                    $('#BelgeOzelKod2').val('@Model.BelgeOzelKod2').trigger('change');
                }
                lib.documentReadyStatusList.OzelKod2 = true;
            }
        });
    }
    function BelgeOzelKod3() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/BelgeOzelKod3Json',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#BelgeOzelKod3');
                $('option', options).remove();
                options.append($('<option />').val('').text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                if ('@Model.BelgeOzelKod3') {
                    $('#BelgeOzelKod3').val('@Model.BelgeOzelKod3').trigger('change');
                }
                lib.documentReadyStatusList.OzelKod3 = true;
            }
        });
    }
    function BelgeOzelKod4() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/BelgeOzelKod4Json',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#BelgeOzelKod4');
                $('option', options).remove();
                options.append($('<option />').val('').text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                 if ('@Model.BelgeOzelKod4') {
                    $('#BelgeOzelKod4').val('@Model.BelgeOzelKod4').trigger('change');
                }
                lib.documentReadyStatusList.OzelKod4 = true;
            }
        });
    }
     function BelgeOzelKod5() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/BelgeOzelKod5Json',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#OzelKod');
                $('option', options).remove();
                options.append($('<option />').val('').text("Seçiniz"));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });

                 if ('@Model.OzelKod') {
                     $('#OzelKod').val('@Model.OzelKod').trigger('change');
                }
                lib.documentReadyStatusList.OzelKod5 = true;
            }
        });
    }

    function SablonList() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/SablonSelectListJson',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#Sablon');
                $('option', options).remove();
                options.append($('<option />').val(0).text("Seçiniz"));
                $.each(data, function () {
                    if (this.Selected) {
                        options.append($('<option selected/>').val(this.Value).text(this.Text));
                    } else {
                        options.append($('<option />').val(this.Value).text(this.Text));
                    }
                });
                 $('#Sablon').val('@Model.Sablon').trigger('update');
                //if (user.FasterSubeID) {
                //    $('#Stok').val(user.FasterSubeID).trigger('change');
                //}
                lib.documentReadyStatusList.Sablon = true;
            }
        });
    }

    $(document).ready(function () {



        var atla = false;
        $('#Cari').change(function () {
            if (!'@Model.Cari') {
                if (alisbelgesi.BelgeHarekets.length > 0 && atla == false) {
                    alert("Öncelikle Ürünleri siliniz.");
                    atla = true;
                    $('#Cari').val(alisbelgesi.Cari).trigger('change');
                } else {
                    alisbelgesi.Cari = $('#Cari').val();
                    atla = false;
                }
            }

            if ($('#Cari').val()) {

                var selectAltCari;
                $.ajax({
                    url: '/SefimPanelBelgeIslemleri/DepoForCariJson',
                    type: 'POST',
                    beforeSend: function (request) {
                        //mApp.blockPage();
                    },
                    complete: function () {
                        window.setTimeout(function () {
                            //mApp.unblockPage();
                        }, 100);
                    },
                    dataType: 'json',
                    success: function (data) {
                        $.each(data, function () {
                            selectAltCari = this.Text;
                        });
                    }
                });


                $.ajax({
                    url: '/SefimPanelBelgeIslemleri/AlisBelgesiGetAltCari',
                    type: 'POST',
                    data: { CariId: $('#Cari').val() },
                    beforeSend: function (request) {
                        //mApp.blockPage();
                    },
                    complete: function () {
                        window.setTimeout(function () {
                            //mApp.unblockPage();
                        }, 100);
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data)
                          var options = $('#AltCari');
                    $('option', options).remove();
                    options.append($('<option />').val("").text("Seçiniz"));
                        $.each(data, function () {
                            if ('@Model.AltCari') {
                                if ('@Model.AltCari' == this.Value)
                                    options.append($('<option selected/>').val(this.Value).text(this.Text));
                            } else {
                                if (selectAltCari) {
                                    if (this.Text.indexOf(selectAltCari) > -1)
                                        options.append($('<option selected/>').val(this.Value).text(this.Text));
                                    else {
                                        options.append($('<option />').val(this.Value).text(this.Text));
                                    }
                                } else {
                                    options.append($('<option />').val(this.Value).text(this.Text));
                                }

                            }
                        });


                    }
                });
            }

        })



        lib.LoadSablon = function (data,itemobj) {
            var obj = {};

            obj.Id = ((alisbelgesi.BelgeHarekets.length || 0) * (-1)) - 1;

            obj.Stok = itemobj.Stok;
            obj.MalinCinsi = itemobj.MalinCinsi;
            obj.Miktar = itemobj.Miktar;
            obj.Birim = itemobj.Birim;


            if (data.BelgeTip == 93 || data.BelgeTip == 94 || data.BelgeTip == 255) {
                obj.ZayiMiktar = itemobj.ZayiMiktar;
            } else {
                obj.KDV = itemobj.KDV;
                obj.Fiyat = itemobj.Fiyat;
            }

            if (data.BelgeTip == 93 || data.BelgeTip == 94 || data.BelgeTip == 255) {
                obj.SayimTarihDahil = itemobj.SayimTarihDahil;
            } else {
                obj.Tutar = itemobj.Tutar;
            }
            alisbelgesi.BelgeHarekets.push(obj);

            var tr = $('<tr id=' + obj.Id + '></tr>');
            Object.keys(obj).forEach(function (keys) {
                if (keys != "Id") {
                    if (keys != "SayimTarihDahil") {
                        var td = $('<td class=' + keys + '></td>');
                        td.append(obj[keys].toString());
                        tr.append(td);
                    } else {
                        var td = $('<td class=' + keys + ' hidden' + '></td>');
                        td.append(obj[keys].toString());
                        tr.append(td);
                    }
                }
            })

            var buttontd = $('<td></td>');
            buttontd.append($('<a class="btn btn-warning" onclick="lib.OpenModal(' + obj.Id + ')" title="Ürün bilgilerini güncelle">Düzenle</a>'))
            buttontd.append($(' <a class="btn btn-danger" onclick="lib.Clear(' + obj.Id + ')" title="Ürünü sil">Sil</a>'))

            tr.append(buttontd);

            $('#tblCustomersObject').append(tr);

            $('#btnclose').click();
        }



        $('#Sablon').change(function () {

            alisbelgesi.BelgeHarekets = [];
            $('#tblCustomers').find('tr').each(function (columnnumtr, datatr) {
                $('#' + $(datatr).attr('id')).remove();
            });


            $.ajax({
                url: '/SefimPanelBelgeIslemleri/AlisBelgesiGetBelge',
                type: 'POST',
                data: { BelgeId: $('#Sablon').val()},
                beforeSend: function (request) {
                    //mApp.blockPage();
                },
                complete: function () {
                    window.setTimeout(function () {
                        //mApp.unblockPage();
                    }, 100);
                },
                dataType: 'json',
                success: function (data) {
                    $('#BelgeNot').val(data.BelgeNot);
                    data.BelgeHarekets.forEach(function (item) {
                        lib.LoadSablon(data,item)
                    })
                }
            });
        })

        $('#tblCustomers').find('tr').each(function (columnnumtr, datatr) {
            if (columnnumtr > 0) {

                var obj = {};
                obj.Id = $(datatr).attr('id');
                $(datatr).find('td').each(function (columnnum, data) {
                    //console.log($(datatr).attr('id'))
                    //console.log(data)
                    if (data.className) {
                        obj[data.className] = data.innerText;
                    }
                })
                //console.log(obj)
                alisbelgesi.BelgeHarekets.push(obj);
            }
            //console.log(columnnumtr, datatr)
        })




        $('#MalinCinsi').select2({
            dropdownParent: $('#belgeHareketCreateModal')
        });
        $("#Birim").select2();

        $("#MalinCinsi").on("change", function () {

            if ($('#MalinCinsi').val()) {
            $.ajax(
                {
                    url: '/SefimPanelBelgeIslemleri/StokDetayListJson?StokId=' + $('#MalinCinsi').val() + '&Cari=' + ($('#Cari').val()||'1'),
                    type: 'GET',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (response) {
                        console.log("res:",response)
                        if (response && response.length > 0) {
                            var options = $('#Birim');
                            $('option', options).remove();
                            options.append($('<option />').val(response[0].BirimInd).text(response[0].BirimAdi));
                            $('#Birim').val(response[0].BirimInd);
                            if ($('#BelgeTip').val() == 135) {//Talep se  || $('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 94 ve Sayımsa devre dışı
                                $('#Fiyat').val(response[0].SatisFiyati);
                            } else {
                                $('#Fiyat').val(response[0].AlisFiyati);
                            }
                            $('#KDV').val(response[0].Kdv);
                            lib.hesapla();
                        }
                    },
                    error: function () {
                        alert("error");
                    }

                });
        }
        });
    });

    $('#Fiyat').on('keyup', function () {
        lib.hesapla();
    });
    $('#Miktar').on('keyup', function () {
        lib.hesapla();
    });
    $('#Isk1').on('keyup', function () {
        if ($('#Isk1').val() > 100) {
            $('#Isk1').val(100)
        }
        if ($('#Isk1').val() < 0) {
            $('#Isk1').val(0)
        }
        lib.hesapla();
    });
    $('#Isk2').on('keyup', function () {
        if ($('#Isk2').val() > 100) {
            $('#Isk2').val(100)
        }
        if ($('#Isk2').val() < 0) {
            $('#Isk2').val(0)
        }
        lib.hesapla();
    });
    $('#Isk3').on('keyup', function () {
        if ($('#Isk3').val() > 100) {
            $('#Isk3').val(100)
        }
        if ($('#Isk3').val() < 0) {
            $('#Isk3').val(0)
        }
        lib.hesapla();
    });
    $('#Isk4').on('keyup', function () {
        if ($('#Isk4').val() > 100) {
            $('#Isk4').val(100)
        }
        if ($('#Isk4').val() < 0) {
            $('#Isk4').val(0)
        }
        lib.hesapla();
    });
    $('#KDV').on('keyup', function () {
        lib.hesapla();
    });

    lib.hesapla = function () {
        var miktar = 0;
        var fiyat = 0;
        var kdv = 0;
        if ($('#Miktar').val())
            miktar = $('#Miktar').val().replace(',', '.');
        if ($('#Fiyat').val())
            fiyat = $('#Fiyat').val().replace(',', '.');
        if ($('#KDV').val())
            kdv = $('#KDV').val().replace(',', '.');
        var tutar = "0";
        const cb = document.querySelector('#Kdv');
        console.log(cb.checked)
        var iskontotutari = 0;
        if ($('#Isk1').val()) {
            iskontotutari += (fiyat - iskontotutari) * $('#Isk1').val().replace(',', '.') / 100;
        }
        if ($('#Isk2').val()) {
            iskontotutari += (fiyat - iskontotutari) * $('#Isk2').val().replace(',', '.') / 100;
        }
        if ($('#Isk3').val()) {
            iskontotutari += (fiyat - iskontotutari) * $('#Isk3').val().replace(',', '.') / 100;
        }
        if ($('#Isk4').val()) {
            iskontotutari += (fiyat - iskontotutari) * $('#Isk4').val().replace(',', '.') / 100;
        }


        if (!cb.checked) {
            tutar = (miktar * (fiyat - iskontotutari)) + ((miktar * (fiyat - iskontotutari)) * kdv / 100);
        } else {
            tutar = miktar * (fiyat - iskontotutari)
        }
        $('#Tutar').val(parseFloat(tutar).toFixed(2))
    }
    $('#Kdv').on('change', function () {
        if ($('#BelgeTip').val() == 26 || $('#BelgeTip').val() == 20 || $('#BelgeTip').val() == 29 || $('#BelgeTip').val() == 23 || $('#BelgeTip').val() == 165) {
            if (alisbelgesi.BelgeHarekets.length > 0) {
                var val = false;
                const cb = document.querySelector('#Kdv');
                if (cb.checked == true) {
                    val = false;
                } else {
                    val = true;
                }
                $('#Kdv').prop("checked", val);
                alert("Lütfen öncelikle hareketleri boşaltınız.");
            }
        } else {
            $('#Kdv').prop("checked", false);
            alert("Belge Tipiniz KDV dahil hesaplamaya uygun değildir.");
        }

    })

    lib.onayla = function (Id) {

        if (!lib.DocumentReadyControl()) {
            alert("Lütfen sayfanın yüklenmesini bekleyin.")
        } else {
if (confirm("Belgeyi onaylamak istiyor musunuz?")) {


            if (alisbelgesi.BelgeHarekets.length > 0) {
                alisbelgesi.Id = $('#Id').val();
                alisbelgesi.BelgeTip = $('#BelgeTip').val();
                alisbelgesi.Tarih = $('#Tarih').val();
                alisbelgesi.BelgeNo = $('#BelgeNo').val();
                alisbelgesi.Personel = $('#Personel').val();
                alisbelgesi.Sube = $('#Sube').val();
                alisbelgesi.Kdv = $('#Kdv').val();
                alisbelgesi.BelgeOzelKod1 = $('#BelgeOzelKod1').val();
                alisbelgesi.BelgeOzelKod2 = $('#BelgeOzelKod2').val();
                alisbelgesi.BelgeOzelKod3 = $('#BelgeOzelKod3').val();
                alisbelgesi.BelgeOzelKod4 = $('#BelgeOzelKod4').val();
                alisbelgesi.OzelKod = $('#OzelKod').val();
                alisbelgesi.Depo = $('#Depo').val();
                alisbelgesi.CikanDepo = $('#CikanDepo').val();
                alisbelgesi.BelgeNot = $('#BelgeNot').val();
                alisbelgesi.Cari = $('#Cari').val();
                alisbelgesi.AltCari = $('#AltCari').val();
                if ($('#BelgeTip').val() == 93 || $('#BelgeTip').val() == 94 || $('#BelgeTip').val() == 255 || $('#BelgeTip').val() == 128 || $('#BelgeTip').val() == 129) {
                    alisbelgesi.Cari = 1;
                }
                alisbelgesi.Kasa = $('#Kasa').val();
                alisbelgesi.SablonAdi = $('#SablonAdi').val();
                alisbelgesi.Sablon = $('#Sablon').val();
                $.ajax({
                    type: "POST",
                    url: '/SefimPanelBelgeIslemleri/AlisBelgesiCreateInsert',
                    data: alisbelgesi,
                    success: function (data) {
                        console.log(data)
                        $.ajax({
                            url: '/SefimPanelBelgeIslemleri/AlisBelgesiOnay',
                            type: 'POST',
                            data: { BelgeId: Id },
                            beforeSend: function (request) {
                                //mApp.blockPage();
                            },
                            complete: function () {
                                window.setTimeout(function () {
                                    //mApp.unblockPage();
                                }, 100);
                            },
                            dataType: 'json',
                            success: function (data) {
                                if (data.IsSuccess) {
                                    alert("Onaylama başarılı.");
                                     if ('@Model.Page') {
                                        location.href ='@Model.Page'
                                    } else {
                                        location.href = "/SefimPanelBelgeIslemleri/AlisBelgesiList";
                                    }
                                }
                                else {
                                    alert("Bilgi eklenemedi." + data.UserMessage);
                                }

                            },
                            error: function (err) {
                                alert(error.UserMessage)
                            }
                        });

                        //alert("Kayıt başarılı.");
                    },
                    error: function (err) {
                        console.log(err)
                        alert("Bilgi eklenemedi.");
                    }
                });
            } else {
                alert("Lütfen öncelikle Stok ekleyiniz.");
            }



        } else {

        }
        }





    }

</script>

