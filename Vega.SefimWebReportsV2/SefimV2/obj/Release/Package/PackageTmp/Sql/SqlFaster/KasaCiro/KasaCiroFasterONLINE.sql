declare @Sube nvarchar(100) = '{SUBEADI}';
declare @Trh1 nvarchar(20) = '{TARIH1}';
declare @Trh2 nvarchar(20) = '{TARIH2}';


WITH Toplamsatis 
AS ( 

SELECT
@Sube as Sube,
(SELECT SUBEADI FROM F0101TBLKRDSUBELER WHERE IND=TBLFASTERODEMELER.SUBEIND) AS Sube1,
(SELECT KASAADI FROM F0101TBLKRDKASALAR WHERE IND=TBLFASTERODEMELER.KASAIND) AS Kasa,
 ODENEN AS cash, 0 AS Credit, 0 AS Ticket, 0 AS KasaToplam  FROM DBO.TBLFASTERODEMELER
WHERE ODEMETIPI=0 AND ISNULL(IADE,0)=0 AND 
TARIH >= @Trh1 AND TARIH <= @Trh2 



UNION ALL

SELECT
@Sube as Sube,
(SELECT SUBEADI FROM F0101TBLKRDSUBELER WHERE IND=TBLFASTERODEMELER.SUBEIND) AS Sube1,
(SELECT KASAADI FROM F0101TBLKRDKASALAR WHERE IND=TBLFASTERODEMELER.KASAIND) AS Kasa,
 0 AS cash, ODENEN AS Credit, 0 AS Ticket, 0 AS KasaToplam   FROM DBO.TBLFASTERODEMELER
WHERE ODEMETIPI=1 AND ISNULL(IADE,0)=0 AND 
TARIH >= @Trh1 AND TARIH <= @Trh2


UNION ALL

SELECT
@Sube as Sube,
(SELECT SUBEADI FROM F0101TBLKRDSUBELER WHERE IND=TBLFASTERODEMELER.SUBEIND) AS Sube1,
(SELECT KASAADI FROM F0101TBLKRDKASALAR WHERE IND=TBLFASTERODEMELER.KASAIND) AS Kasa,
 0 AS cash, 0 AS Credit,ODENEN AS Ticket,0 AS KasaToplam   FROM DBO.TBLFASTERODEMELER
WHERE ODEMETIPI=2 AND ISNULL(IADE,0)=0 AND 
TARIH >= @Trh1 AND TARIH <= @Trh2





UNION ALL
SELECT
@Sube as Sube,
(SELECT SUBEADI FROM F0101TBLKRDSUBELER WHERE IND=TBLFASTERKASAISLEMLERI.SUBEIND) AS Sube1,
(SELECT KASAADI FROM F0101TBLKRDKASALAR WHERE IND=TBLFASTERKASAISLEMLERI.KASAIND) AS Kasa,
 0 AS cash, 0 AS Credit,0 AS Ticket, SUM(GELIR-GIDER)	 AS KasaToplam   FROM DBO.TBLFASTERKASAISLEMLERI
WHERE 
TARIH >= @Trh1 AND TARIH <= @Trh2
GROUP BY 
SUBEIND ,
KASAIND 



) 
SELECT Sube,Sube1,Kasa
,SUM(Cash) AS Cash 
,SUM(Credit) AS Credit 
,Sum(Ticket) AS Ticket 
,Sum(KasaToplam) as KasaToplam

,SUM(Cash+Credit+Ticket+Debit) AS ToplamCiro
,0 AS Saniye
,'' AS RowStyle
,'' AS RowError
FROM toplamsatis  
GROUP BY Sube