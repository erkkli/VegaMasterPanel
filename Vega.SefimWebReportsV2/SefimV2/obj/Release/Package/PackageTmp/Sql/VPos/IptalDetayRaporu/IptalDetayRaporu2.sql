	
declare @Trh1 nvarchar(20) = '{TARIH1}';
declare @Trh2 nvarchar(20) = '{TARIH2}';
declare @Sube nvarchar(100) = '{SUBEADI}';
declare @Sube2 nvarchar(100) = '{SUBE2}';
declare @Kasa nvarchar(100) = '{KASAKODU}';


SELECT 

ISNULL(
(SELECT COUNT(*) FROM TBLSPOSSATISBASLIKLOG WITH(NOLOCK) WHERE  B.IADE=0 AND B.IPTAL=0 AND B.OLUSTURMATARIHI>=@Trh1 AND B.OLUSTURMATARIHI<=@Trh2)

,0)
 printcount,
 -- ISNULL(Sum(Quantity*OriginalPrice),0) AS ToplamIptalTutari,
B.OLUSTURMATARIHI as Date, B.SONDEGISTIRME DeletingTime,BELGENO TableNumber,STOKADI ProductName,H.ACIKLAMA DeleteReason,
ISNULL(K.KODU,'')+'-'+ISNULL(K.ADI,'') UserName,H.FIYAT Price, h.MIKTAR Quantity,ISNULL(K2.KODU,'')+'-'+ISNULL(K2.ADI,'') DeletingUserName
	FROM TBLSPOSSATISHAREKETLOG H WITH(NOLOCK)
	LEFT JOIN TBLSPOSSATISBASLIKLOG B WITH(NOLOCK) ON B.IND=H.BASLIKIND
	LEFT JOIN TBLSPOSKULLANICILAR K WITH(NOLOCK) ON K.IND=B.KULLANICIIND
	LEFT JOIN TBLSPOSKULLANICILAR K2 WITH(NOLOCK) ON K2.IND=B.SONDEGISTIREN
	WHERE  B.IADE=0 AND B.IPTAL=0 AND B.OLUSTURMATARIHI>=@Trh1 AND B.OLUSTURMATARIHI<=@Trh2 
	AND SUBEIND IN (SELECT IND FROM TBLSPOSSUBELER  WITH(NOLOCK) WHERE ISNULL(IsDeleted,0)=0 AND KODU=@Sube2)   
AND KASAIND IN (SELECT IND FROM TBLSPOSKASALAR  WITH(NOLOCK) WHERE ISNULL(IsDeleted,0)=0 AND Charindex('&'+KODU+'&',@kasa)>0)