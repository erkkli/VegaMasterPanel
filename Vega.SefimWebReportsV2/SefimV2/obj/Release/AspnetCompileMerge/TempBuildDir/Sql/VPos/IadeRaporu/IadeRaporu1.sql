declare @par1 nvarchar(20) = '{TARIH1}';
declare @par2 nvarchar(20) = '{TARIH2}';
declare @Sube nvarchar(100) = '{SUBEADI}';
	declare @Sube2 nvarchar(100) = '{SUBE2}';
declare @Kasa nvarchar(100) = '{KASAKODU}';


SELECT 

sum(TUTAR) Tutar,abs(sum(H.MIKTAR)) Miktar,H.STOKADI ProductName
	FROM TBLSPOSSATISHAREKET H WITH(NOLOCK)
	LEFT JOIN TBLSPOSSATISBASLIK B WITH(NOLOCK) ON B.IND=H.BASLIKIND
WHERE IADE=1 AND IPTAL=0 AND OLUSTURMATARIHI>=@par1 AND OLUSTURMATARIHI<=@par2
AND SUBEIND IN (SELECT IND FROM TBLSPOSSUBELER  WITH(NOLOCK) WHERE ISNULL(IsDeleted,0)=0 AND KODU=@Sube2)   
AND KASAIND IN (SELECT IND FROM TBLSPOSKASALAR  WITH(NOLOCK) WHERE ISNULL(IsDeleted,0)=0 AND Charindex('&'+KODU+'&',@kasa)>0)

group by H.STOKADI


