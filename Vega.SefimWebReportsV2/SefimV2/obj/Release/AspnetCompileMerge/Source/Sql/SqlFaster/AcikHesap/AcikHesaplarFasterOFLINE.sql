DECLARE @Sube nvarchar(100) = '{SUBE}';

DECLARE @Trh1 nvarchar(20) = '{TARIH1}';

DECLARE @Trh2 nvarchar(20) = '{TARIH2}';

WITH Toplamsatis AS
  (SELECT @Sube AS Sube,

     (SELECT TOP 1 SUBEADI
      FROM TBLFASTERKASALAR
      WHERE SUBENO=TBLFASTERODEMELER.SUBEIND) AS Sube1,

     (SELECT KASAADI
      FROM TBLFASTERKASALAR
      WHERE KASANO=TBLFASTERODEMELER.KASAIND) AS Kasa,
          0 AS Tahsilat,
          ODENEN AS Debit,
          0 AS zayi
   FROM DBO.TBLFASTERODEMELER
   WHERE ODEMETIPI=4
     AND ISNULL(IADE, 0)=0
     AND ISLEMTARIHI >= @Trh1
     AND ISLEMTARIHI <= @Trh2
   UNION ALL SELECT @Sube AS Sube,

     (SELECT TOP 1 SUBEADI
      FROM TBLFASTERKASALAR
      WHERE SUBENO=TBLFASTERODEMELER.SUBEIND) AS Sube1,

     (SELECT KASAADI
      FROM TBLFASTERKASALAR
      WHERE KASANO=TBLFASTERODEMELER.KASAIND) AS Kasa,
                    ODENEN AS Tahsilat,
                    0 AS Debit,
                    0 AS zayi
   FROM DBO.TBLFASTERODEMELER
   WHERE ISNULL(IADE, 0)=0
     AND ISNULL(TAHSILAT, 0)=1
     AND ISNULL(GIRIS, 0)=1
     AND ISLEMTARIHI >= @Trh1
     AND ISLEMTARIHI <= @Trh2
   UNION ALL SELECT @Sube AS Sube,

     (SELECT TOP 1 SUBEADI
      FROM TBLFASTERKASALAR
      WHERE SUBENO=TBLFASTERODEMELER.SUBEIND) AS Sube1,

     (SELECT KASAADI
      FROM TBLFASTERKASALAR
      WHERE KASANO=TBLFASTERODEMELER.KASAIND) AS Kasa,
                    ODENEN*-1 AS Tahsilat,
                    0 AS Debit,
                    0 AS zayi
   FROM DBO.TBLFASTERODEMELER
   WHERE ISNULL(IADE, 0)=0
     AND ISNULL(TAHSILAT, 0)=0
     AND ISNULL(GIRIS, 0)=0
     AND ISLEMTARIHI >= @Trh1
     AND ISLEMTARIHI <= @Trh2 )
SELECT Sube,
       Sube1,
       Kasa,
       SUM(Tahsilat) AS Total ,
       SUM(Debit) AS Debit
FROM toplamsatis
GROUP BY Sube,
         Sube1,
         Kasa