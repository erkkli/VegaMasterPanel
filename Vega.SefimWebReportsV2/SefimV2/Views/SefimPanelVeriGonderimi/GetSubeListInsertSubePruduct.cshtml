@model  SefimV2.ViewModels.SPosVeriGonderimi.SubelereVeriGonderViewModel

@{
    Layout = "~/Views/Shared/_LayoutPageSPos.cshtml";
}
<link href="~/Content/ContentSefPanel/css/costomfieldset/customfielset.css" rel="stylesheet" />
<div class="m-content">
    <div class="row">
        <div class="col-lg-12">
            <ul>
                @if (Model.SuccessAlertList != null && Model.SuccessAlertList.Count > 0)
                {
                    foreach (var errors in Model.SuccessAlertList)
                    {
                        <li class="alert alert-success">@errors</li>
                    }
                }
            </ul>
            <div id="notification"></div>
        </div>
    </div>
    <div class="col-lg-12">
        <fieldset class="well the-fieldset margin-bottom-5 padding-bottom-10 padding-top-10 table-responsive-lg">
            <legend class="the-legend">Şube Listesi</legend>
            <div class="col-lg-6">
                @using (Html.BeginForm("GetSubeListInsertSubePruduct", "SefimPanelVeriGonderimi", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary()
                    <fieldset class="well the-fieldset margin-bottom-5 padding-bottom-10 padding-top-10">
                        <legend class="the-legend">Hedef Şube</legend>
                        <div class="col-md-3">
                            <input type="submit" value="Fiyat Güncelle" class="btn btn-primary" title="Seçili şubelerde fiyat güncellemesi yapma" />
                            @*<a class="btn btn-lg btn-success" href="@Url.Action("EditSubeProduct", "SefimPanelVeriGonderimi")" title="Şubedeki ürün bilgilerini güncelle">
                                    Hazırlanan Ürünler
                                </a>*@
                        </div>
                        @if (Model.IsSelectedSubeList != null && Model.IsSelectedSubeList.Count > 0)
                        {
                            <div id="gridView">
                                <table id="tableHedefSube" class="table table-striped table table-hover table-condensed  table-bordered table-responsive">
                                    <thead>
                                        <tr style="background: #fffaf0">
                                            <th width="15%"> <a class="btn btn-default">  <input type="checkbox" id="tumunuSec" /> </a>Tümünü Seç</th>
                                            <th width="30%">Şube Adı</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{
                                            for (int i = 0; i < Model.IsSelectedSubeList.Count; i++)
                                            {
                                                if (!string.IsNullOrEmpty(Model.IsSelectedSubeList[i].SubeName))
                                                {
                                                    @Html.HiddenFor(m => Model.IsSelectedSubeList[i].ID)
                                                    @Html.HiddenFor(m => Model.IsSelectedSubeList[i].SubeName)
                                                    @Html.HiddenFor(m => Model.IsSelectedSubeList[i].DBName)
                                                    <tr>
                                                        <td hideExcel="true"> <a class="btn  btn-default"> @Html.CheckBoxFor(x => Model.IsSelectedSubeList[i].IsSelectedHedefSube)  </a> </td>
                                                        <td> <label class="btn btn-default" style="width:100%">  <h style="font-size:small;">@Model.IsSelectedSubeList[i].SubeName  </h>  </label>  </td>
                                                    </tr>
                                                }
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </fieldset>
                }
            </div>
            <div class="col-lg-6">

                @using (Html.BeginForm("GetSubeListInsertSubePruduct", "SefimPanelVeriGonderimi", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @*@Html.ValidationSummary()*@

                    <fieldset class="well the-fieldset margin-bottom-5 padding-bottom-10 padding-top-10">
                        <legend class="the-legend">Güncellenecek Şubeler</legend>

                        @if (Model.GuncellenecekSubeGruplariList != null && Model.GuncellenecekSubeGruplariList.Count > 0)
                        {
                            for (int e = 0; e < Model.GuncellenecekSubeGruplariList.Count; e++)
                            {
                                @*<input type="submit" value="Fiyat Güncelle" class="btn btn-lg btn-primary" title="Seçili şubelerde fiyat güncellemesi yapma" />*@

                                if (Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList != null && (Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList.Count) > 0)
                                {
                                    <div id="gridView_@Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId">
                                        <div class="clearfix">
                                            <a class="btn btn-warning" href="@Url.Action("EditSubeProduct", "SefimPanelVeriGonderimi", new { subeIdGrupList = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId })" title="Şubedeki ürün bilgilerini güncelle">
                                                Hazırlanan Ürünlere Git
                                            </a>
                                            @*<a href="@Url.Action("GetSubeListInsertSubePruduct", "SefimPanelVeriGonderimi", new { isUpdate = true, SubeIdGrupList = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId })"  class="btn btn-success"> Şubelere Gönder </a>*@
                                            <input type="submit" name="Şubelere Gönder" value="Şubelere Gönder" formaction=@Url.Action("GetSubeListInsertSubePruduct","SefimPanelVeriGonderimi",new { isUpdate = true, SubeIdGrupList = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId }) formmethod="post" class="btn btn-success" />
                                            @*<button type="submit" name="Merkez Datada Hazırlanan Ürünleri Aktif Tüm Şubelere Gönderiri" value="Tüm Şubelere Yay" formaction=@Url.Action("GetSubeListInsertSubePruduct","SefimPanelVeriGonderimi",new { isUpdate = true, SubeIdGrupList ="TumSubelereYay" }) formmethod="post" class="btn btn-primary">
                                                    <i class="fa fa fa-share"></i>  Tüm Şubelere Yay
                                                </button>*@
                                            @*<a  class="btn btn-primary btntumSubelereYay" data-url=@Url.Action("IsActiveSubeList","SefimPanelVeriGonderimi",
                                                                                                                   new { isUpdate = true, SubeIdGrupList ="TumSubelereYay",
                                                                                                                         IsSelectedSube = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId
                                                                                                                     }) >
                                                    <i class="fa fa fa-share"></i>  Tüm Şubelere Yay
                                                </a>*@

                                            <a class="btn btn-danger" onclick="lib.sil('@Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId','@Model.IsSelectedSubeList.ToList()') " title="Hazırlanmakta olan ürünleri siler">
                                                <i class="fa fa fa-trash"></i> Hazırlanan Ürünleri Sil
                                            </a>
                                        </div>
                                        <table id="tableHazirlananUrunler" class="table table-striped table table-hover table-condensed  table-bordered table-responsive">
                                            <thead>
                                                <tr style="background: #fffaf0">
                                                    <th width="16%"> <a class="btn btn-default"> <input data-subeId="@Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId" class="btnSec" type="checkbox" id="hazirlananSubeTumunuSec" /> </a>Tümünü Seç</th>
                                                    <th width="10%"> Güncelle</th>
                                                    <th width="10%"> İşlem</th>
                                                    <th> Şube Adı</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @{
                                                    for (int i = 0; i < Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList.Count; i++)
                                                    {
                                                        @Html.HiddenFor(m => Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].ID)
                                                        @Html.HiddenFor(m => Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].SubeName)
                                                        @Html.HiddenFor(m => Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].DBName)
                                                        <tr>
                                                            <td hideExcel="true">
                                                                <a class="btn btn-default" id="@Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId">
                                                                    @Html.CheckBoxFor(x => Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].IsSelectedHazirlananSubeList)
                                                                </a>
                                                            </td>
                                                            <td>
                                                                <a class="btn btn-primary btntumSubelereYay" data-url=@Url.Action("IsActiveSubeList","SefimPanelVeriGonderimi",
                                                                                                               new {
                                                                                                                     isUpdate = true, SubeIdGrupList ="TumSubelereYay",
                                                                                                                     subeGrupList = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId,
                                                                                                                     subeId = Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].ID,
                                                                                                                  })
                                                                   title="Şubelere yay">
                                                                    <i class="fa fa fa-share"></i>  Tüm Şubelere Yay
                                                                </a>
                                                            </td>
                                                            <td>
                                                                <a class="fa fa-trash btn  btn-large btn-danger" title="Şube sil" href="@Url.Action("DeleteSube", "SefimPanelVeriGonderimi", new {
                                                                                                                                       subeIdGrupList = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupId,
                                                                                                                                       subeId = Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].ID,
                                                                                                                                       subeAdiGrupList = Model.GuncellenecekSubeGruplariList[e].GuncellenecekSubeGrupAdi,
                                                                                                                                       subeName= Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].SubeName,
                                                                                                                                   })" onclick="return confirm('Şubeyi silmek istiyormusunuz?')">
                                                                    Sil
                                                                </a>
                                                            </td>
                                                            <td> <label class="btn btn-default" style="width:100%">  <h style="font-size:small;"> @Model.GuncellenecekSubeGruplariList[e].FiyatGuncellemsiHazirlananSubeList[i].SubeName </h>  </label>  </td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                }
                            }
                        }
                    </fieldset>
                }
            </div>
            <div class="col-md-offset-5 col-md-7 center">
                <a href="@Url.Action("Main", "SefimPanelHome", new { subeId = Model.IsSelectedSubeList.FirstOrDefault().ID })" class="btn btn-danger"> Vazgeç </a>
            </div>
        </fieldset>
    </div>
</div>

<script type="text/javascript">


    $(".btntumSubelereYay").on("click", function () {
        $('#genericModal').find(".modal-body").html("");
        var dataurl = $(this).data("url");
        callModalPage(dataurl, "Şube Listesi");
        showProgressBar();
        $("#modalPleaseWait").on('shown.bs.modal', function () {
        });
    });

    var lib = {};
    lib.sil = function (subeIdGrupList, isSelectedSubeList) {

        if (confirm("Hazırlanan Ürünleri silmek istiyor musunuz?")) {
            $.ajax(
                {
                    url: '/SefimPanelVeriGonderimi/Delete',
                    type: 'POST',
                    dataType: 'json',
                    data: { SubeIdGrupList: subeIdGrupList, IsSelectedSubeList: isSelectedSubeList },
                    success: function (response) {
                        if (response.IsSuccess) {
                            location.reload();
                        } else {
                            alert(response.UserMessage)
                        }
                    },
                    error: function () {
                        alert("error");
                    }
                });
        }
    }

    $(document).on("change", '#tumunuSec', function () {
        debugger;
        var seciliMi = $(this).is(":checked");
        $('#tableHedefSube tbody').find('[type="checkbox"]').prop("checked", seciliMi);
    })

    $(document).on("change", '#hazirlananSubeTumunuSec', function () {
        debugger;
        var seciliMi = $(this).is(":checked");

        $('#tableHedefSube tbody').find('[type="checkbox"]').prop("checked", seciliMi);

        $('#tableHazirlananUrunler tbody').find('[id="' + $(this).attr('data-subeid') + '"]').find('[type="checkbox"]').prop("checked", seciliMi);
    })

</script>