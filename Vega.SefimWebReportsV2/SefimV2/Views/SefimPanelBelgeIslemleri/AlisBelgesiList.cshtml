@model SefimV2.ViewModels.SPosKabulIslemleri.BelgeList
@{
    Layout = "~/Views/Shared/_LayoutPageSPos.cshtml";
}

<link href="/Assets/css/bootstrap.css" rel="stylesheet" />
<link href="/Assets/css/custom.css" rel="stylesheet" />
<link href="/Assets/plugins/fUpload/Uploader-style.css" rel="stylesheet" />

@*<a class="btn btn-primary  pull-right" href="/SefimPanelBelgeIslemleri/AlisBelgesiCreate" title="güncelle">
        <i class="glyphicon glyphicon-plas"></i>
        Yeni Belge Oluştur
    </a>*@

<div class="col-sm-2">
    <div class="col-sm-12"><label>Başlangıç Tarihi</label></div>
    <input type="date" value="@Model.BaslangicTarihi" class="form-control has-feedback-left" id="BaslangicTarihi" placeholder="Seçiniz">
</div>
<div class="col-sm-2">
    <div class="col-sm-12"><label>Bitiş Tarihi</label></div>
    <input type="date" value="@Model.BitisTarihi" class="form-control has-feedback-left" id="BitisTarihi" placeholder="Seçiniz">
</div>
<div class="col-sm-1">
    <div class="col-sm-12"><label>Belge Tipi</label></div>
    @Html.EnumDropDownListFor(model => model.BelgeTipi, new { @id = "BelgeTipi" })
</div>
<div class="col-sm-1">
    <div class="col-sm-12"><label>Şube</label></div>
    @Html.DropDownListFor(model => model.Sube, new List<SelectListItem>(), new { @id = "Sube", @class = "form-control m-select2" })
</div>
<div class="col-sm-1">
    <div class="col-sm-12"><label>Durum</label></div>
    @Html.EnumDropDownListFor(model => model.OnayDurumu, new { @id = "OnayDurumu" })
</div>
<div class="col-sm-1">
    <div class="col-sm-12"><label></label></div>
    <button id="Filitrele" class="btn btn-primary">Filtrele</button>
</div>



<table id="tblCustomers" class="table table-hover table-bordered table-condensed">
    <thead>
        <tr>
            <th style="width:100px">İşlemler</th>
            <th style="width:150px">Tarih</th>
            <th style="width:150px">Belge No</th>
            <th style="width:60px">Belge Kod</th>
            <th style="width:60px">Belge Tip</th>
            @*<th style="width:60px">Kdv</th>*@
            <th style="width:60px">Tutar</th>
            <th style="width:60px">Şube</th>
            <th style="width:60px">Onay Durumu</th>
        </tr>
    </thead>
    <tbody id="tblCustomersObject">
        @{
            if (@Model != null)
            {
                for (int i = 0; i < @Model.Belgeler.Count(); i++)
                {
                    <tr id="@Model.Belgeler[i].Id">
                        <td>
                            <a class="btn btn-warning" href="/SefimPanelBelgeIslemleri/AlisBelgesiCreate?ID=@Model.Belgeler[i].Id" title="Şubedeki ürün bilgilerini güncelle">
                                Düzenle
                            </a>
                            @if (@Model.Belgeler[i].OnayDurumu != 1)
                            {
                                <a class="btn btn-danger" onclick="lib.sil(@Model.Belgeler[i].Id)" title="Sil">
                                    Sil
                                </a>
                            }

                        </td>
                        <td class="CustomerId">
                            <span>@Model.Belgeler[i].Tarih.Value.ToString("dd.MM.yyyy")</span>
                        </td>
                        <td class="CustomerId">
                            @if (!string.IsNullOrEmpty(@Model.Belgeler[i].BelgeNoArctos))
                            {
                                <span>@Model.Belgeler[i].BelgeNoArctos</span>
                    }
                    else
                    {
                        <span>@Model.Belgeler[i].BelgeNo</span>
                    }
                            </td>
                        <td class="CustomerId">
                            <span>@Model.Belgeler[i].BelgeKod</span>
                        </td>
                        <td class="CustomerId">
                            <span>@Model.Belgeler[i].BelgeTip</span>
                        </td>
                        @*<td class="CustomerId">
                            <span>@Model.Belgeler[i].BelgeKDV</span>
                        </td>*@
                        <td class="CustomerId">
                            <span>@Model.Belgeler[i].BelgeTutar</span>
                        </td>
                        <td class="CustomerId">
                            <span>@Model.Belgeler[i].Sube</span>
                        </td>
                        <td class="CustomerId">
                            <span>@((SefimV2.Enums.General.OnayDurumu)Model.Belgeler[i].OnayDurumu)</span>
                        </td>
                    </tr>
                }
            }
        }
    </tbody>
</table>
<script src="/Assets/js/jquery.js"></script>
<script src="/Assets/plugins/fUpload/jquery.blockUI.js"></script>
<script src="/Assets/js/bootstrap.js"></script>


<script type="text/javascript">
    $('#Filitrele').click(function () {
        var baslangictarihi = $('#BaslangicTarihi').val();
        var bitistarihi = $('#BitisTarihi').val();
        var belgetipi = $('#BelgeTipi').val();
        var sube = $('#Sube').val();
        var onaydurumu = $('#OnayDurumu').val();
        location.search = "?baslangictarihi=" + baslangictarihi + "&bitistarihi=" + bitistarihi + "&belgetipi=" + belgetipi + "&sube=" + sube + "&onaydurumu=" + onaydurumu;
    })

    $(document).ready(function () {
        $("#Sube").select2();
        $('#BelgeTipi').select2();
        $('#OnayDurumu').select2();
        SubeList();
        $('#tblCustomers').DataTable({
            language: {
                info: "_TOTAL_ kayıttan _START_ - _END_ kayıt gösteriliyor.",
                infoEmpty: "Gösterilecek hiç kayıt yok.",
                loadingRecords: "Kayıtlar yükleniyor.",
                zeroRecords: "Tablo boş",
                search: "Arama:",
                infoFiltered: "(toplam _MAX_ kayıttan filtrelenenler)",
                buttons: {
                    copyTitle: "Panoya kopyalandı.",
                    copySuccess: "Panoya %d satır kopyalandı",
                    copy: "Kopyala",
                    print: "Yazdır",
                },

                paginate: {
                    first: "İlk",
                    previous: "Önceki",
                    next: "Sonraki",
                    last: "Son"
                },
            },
            dom: 'Bfrtip',
            "pageLength": 80,
            "bDestroy": true,
            buttons: [
                'copy', 'excel', 'pdf', 'print'
            ],
            //responsive: true
        });
    });
    var lib = {};
    lib.sil = function (Id) {
        if (confirm("Belgeyi silmek istiyor musunuz?")) {
            $.ajax({
                url: '/SefimPanelBelgeIslemleri/AlisBelgesiDelete',
                type: 'POST',
                data: { BelgeId: Id },
                beforeSend: function (request) {
                    //mApp.blockPage();
                },
                complete: function () {
                    window.setTimeout(function () {
                        //mApp.unblockPage();
                    }, 100);
                },
                dataType: 'json',
                success: function (data) {
                    console.log(data)
                },
                error: function (err) {
                    console.log(err)
                }
            });
            $("#" + Id).remove();
        } else {

        }

    }
    function SubeList() {
        $.ajax({
            url: '/SefimPanelBelgeIslemleri/SubeListJson',
            type: 'POST',
            beforeSend: function (request) {
                //mApp.blockPage();
            },
            complete: function () {
                window.setTimeout(function () {
                    //mApp.unblockPage();
                }, 100);
            },
            dataType: 'json',
            success: function (data) {
                var options = $('#Sube');
                $('option', options).remove();
                 options.append($('<option />').val(0).text(""));
                $.each(data, function () {
                    options.append($('<option />').val(this.Value).text(this.Text));
                });
                if ('@Model.Sube') {
                     $('#Sube').val('@Model.Sube').trigger('change');
                }
                @*console.log('@Model.Sube', user.SubeID)
                if ('@Model.Sube') {
                    $('#Sube').val('@Model.Sube').trigger('change');
                } else {
                    if (user.SubeID) {
                        $('#Sube').val(user.SubeID).trigger('change');
                    }
                }
                lib.documentReadyStatusList.Sube = true;*@
            }
        });
    }
</script>
